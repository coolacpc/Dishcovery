<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dishcovery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .screen { display: none; }
        .screen.active { display: block; }
        .star-filled { color: #F59E0B; }
        .btn-primary { background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%); }
        #custom-alert { display: flex; }
        #custom-alert.hidden { display: none; }
        #custom-confirm { display: flex; }
        #custom-confirm.hidden { display: none; }
        .active-tab { color: #DC2626; }
        .active-tab svg { color: #DC2626; }
        #bottom-tabs button { color: #6B7280; transition: color 0.2s; }
        #bottom-tabs button:hover { color: #DC2626; }
        
        /* Pull to Refresh */
        #pull-to-refresh {
            position: fixed;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: top 0.3s ease;
        }
        #pull-to-refresh.active {
            top: 20px;
        }
        #pull-to-refresh svg {
            width: 24px;
            height: 24px;
            color: #DC2626;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
    <body class="bg-gray-50">
        <!-- Pull to Refresh Indicator -->
        <div id="pull-to-refresh">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
        </div>
        
    <div class="max-w-md mx-auto bg-white min-h-screen shadow-lg">
        
        <!-- LOGIN -->
        <div id="login-screen" class="screen active">
            <div class="min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4">
                <div class="w-full max-w-md">
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white font-bold text-2xl">D</span>
                            </div>
                            <h1 class="text-2xl font-bold text-gray-900 mb-1">Dishcovery</h1>
                            <p class="text-sm text-gray-500">Sign in to your account</p>
                        </div>
                        <form onsubmit="event.preventDefault(); handleLogin();" class="space-y-5">
                            <div>
                                <label for="username" class="block text-sm font-medium text-gray-700 mb-1.5">Username</label>
                                <input type="text" id="username" name="username" placeholder="Enter your username" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-1.5">Password</label>
                                <input type="password" id="password" name="password" placeholder="Enter your password" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition">
                            </div>
                            <div id="login-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-2.5 rounded-lg text-sm">Invalid credentials. Please try again.</div>
                            <button type="submit" onclick="handleLogin()" class="w-full btn-primary text-white py-2.5 rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition">Sign In</button>
                        </form>
                        <div class="mt-6 flex items-center justify-center">
                            <button onclick="toggleDemoAccounts()" class="p-2 hover:bg-gray-100 rounded-full transition" title="Show demo accounts">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </button>
                        </div>
                        <div id="demo-accounts" class="mt-4 pt-4 border-t border-gray-200 hidden">
                            <p class="text-xs text-gray-500 text-center mb-3">Demo Accounts</p>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-xs bg-gray-50 rounded-lg p-2.5">
                                    <span class="text-gray-600 font-medium">Customer</span>
                                    <span class="text-gray-900 font-mono">noor / customer12345678</span>
                                </div>
                                <div class="flex items-center justify-between text-xs bg-gray-50 rounded-lg p-2.5">
                                    <span class="text-gray-600 font-medium">Chef Layla</span>
                                    <span class="text-gray-900 font-mono">layla / chef12345678</span>
                                </div>
                                <div class="flex items-center justify-between text-xs bg-gray-50 rounded-lg p-2.5">
                                    <span class="text-gray-600 font-medium">Chef Ahmad</span>
                                    <span class="text-gray-900 font-mono">ahmad / chef12345678</span>
                                </div>
                                <div class="flex items-center justify-between text-xs bg-gray-50 rounded-lg p-2.5">
                                    <span class="text-gray-600 font-medium">Admin</span>
                                    <span class="text-gray-900 font-mono">admin / admin12345678</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- HOME -->
        <div id="home-screen" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-3">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-gradient-to-br from-red-600 to-red-700 rounded-lg flex items-center justify-center">
                                <span class="text-white font-bold text-sm">D</span>
                            </div>
                            <span class="font-bold text-xl text-gray-800">Dishcovery</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="showScreen('cart')" class="relative p-2 hover:bg-gray-100 rounded-full transition-colors">
                                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                                <span id="cart-count-badge" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                            </button>
                            <button onclick="logout()" class="p-2 hover:bg-gray-100 rounded-full">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="mb-2">
                        <input type="text" id="search-input" placeholder="Search dishes, chefs, or categories..." class="w-full px-4 py-3 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm">
                    </div>
                </div>
                <div class="px-4 pb-3 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent" style="scrollbar-width: thin; -ms-overflow-style: -ms-autohiding-scrollbar;">
                    <div class="flex space-x-2 min-w-max">
                        <button onclick="filterContent('all')" class="filter-btn px-4 py-2 bg-red-600 text-white rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">All</button>
                        <button onclick="filterContent('middle-eastern')" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">Middle Eastern</button>
                        <button onclick="filterContent('italian')" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">Italian</button>
                        <button onclick="filterContent('asian')" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">Asian</button>
                        <button onclick="filterContent('desserts')" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">Desserts</button>
                        <button onclick="showChefs()" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">Chefs</button>
                        <button onclick="showScreen('masterclasses-screen')" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0">Masterclasses</button>
                    </div>
                </div>
            </div>
            <div class="p-4 pb-20">
                <h2 class="text-lg font-semibold text-gray-800 mb-4" id="section-title">Popular Dishes</h2>
                <div id="content-grid" class="grid grid-cols-2 gap-4"></div>
            </div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1 active-tab">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- DISH DETAIL -->
        <div id="dish-detail" class="screen">
            <div class="relative">
                <img src="https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=800" class="w-full h-72 object-cover">
                <button onclick="goBack()" class="absolute top-4 left-4 bg-white/90 p-2 rounded-full shadow-lg">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
            </div>
            <div class="p-4">
                <h1 id="dish-detail-name" class="text-2xl font-bold text-gray-800 mb-2">Traditional Mansaf</h1>
                <p id="dish-detail-description" class="text-gray-600 text-sm mb-4">Authentic Jordanian mansaf with tender lamb, rice, and jameed sauce.</p>
                <div class="text-2xl font-bold text-red-600 mb-4" id="dish-detail-price">JOD 12.99</div>
                
                <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <img id="dish-chef-image" src="" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow">
                            <div class="ml-3">
                                <p class="text-xs text-gray-500">Prepared by</p>
                                <p id="dish-chef-name" class="font-semibold text-gray-800"></p>
                            </div>
                        </div>
                        <button onclick="bookChefFromDish()" class="px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700 transition">
                            Book Chef
                        </button>
                    </div>
                    <p id="dish-chef-specialty" class="text-xs text-gray-500"></p>
                </div>
                
                <!-- Customization Options -->
                <div class="bg-white rounded-lg border border-gray-200 p-4 mb-4">
                    <h3 class="font-semibold text-gray-800 mb-3">Customize Your Order</h3>
                    
                    <!-- Add/Remove Ingredients -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Add Extra Ingredients</label>
                        <div id="extra-ingredients-list" class="space-y-2">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Remove Ingredients</label>
                        <div id="remove-ingredients-list" class="space-y-2">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                    
                    <!-- Allergies -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Allergies & Dietary Restrictions</label>
                        <textarea id="dish-allergies" placeholder="List any allergies or dietary restrictions (e.g., gluten-free, no nuts, etc.)" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 h-20"></textarea>
                    </div>
                    
                    <!-- Special Instructions -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
                        <textarea id="dish-special-instructions" placeholder="Any special requests or instructions for preparation" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 h-20"></textarea>
                    </div>
                </div>
            </div>
            <div class="fixed bottom-16 left-0 right-0 max-w-md mx-auto bg-white border-t p-4 z-20">
                <button id="add-to-cart-btn" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">Add to Cart - JOD 12.99</button>
            </div>
            <div class="h-32"></div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- CART -->
        <div id="cart" class="screen">
            <div class="bg-white border-b sticky top-0">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Your Order</h1>
                </div>
            </div>
            <div class="p-4">
                <div id="cart-items-container" class="bg-white rounded-lg shadow p-4 mb-4">
                    <!-- Cart items will be dynamically added here -->
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex justify-between mb-2">
                        <span>Subtotal</span>
                        <span>JOD 12.99</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span>Delivery</span>
                        <span>JOD 2.50</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg pt-2 border-t">
                        <span>Total</span>
                        <span class="text-red-600">JOD 15.49</span>
                    </div>
                </div>
            </div>
            <div class="fixed bottom-16 left-0 right-0 max-w-md mx-auto bg-white border-t p-4 z-20">
                <button onclick="showScreen('edit-order')" class="w-full btn-primary text-white py-4 rounded-lg font-bold">Edit Order - JOD 15.49</button>
            </div>
            <div class="h-32"></div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- EDIT ORDER -->
        <div id="edit-order" class="screen">
            <div class="bg-white border-b sticky top-0">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Edit Order</h1>
                </div>
            </div>
            <div class="p-4">
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Order Items</h3>
                    <div id="order-items-list" class="space-y-3">
                        <!-- Items will be dynamically added here -->
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Delivery Location</h3>
                    <div class="mb-3">
                        <input type="text" id="delivery-location" placeholder="Enter your delivery address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="text-sm text-gray-500">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        We'll deliver to this address
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Payment Method</h3>
                    <div class="space-y-3">
                        <label class="payment-option flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-red-500 transition" onclick="selectPayment('cash', this)">
                            <input type="radio" name="payment" value="cash" class="mr-3" id="payment-cash" checked>
                            <div class="flex-1">
                                <div class="font-semibold">Cash on Delivery</div>
                                <div class="text-sm text-gray-500">Pay when you receive your order</div>
                            </div>
                        </label>
                        <label class="payment-option flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-red-500 transition" onclick="selectPayment('visa', this)">
                            <input type="radio" name="payment" value="visa" class="mr-3" id="payment-visa">
                            <div class="flex-1">
                                <div class="font-semibold">Visa Card</div>
                                <div class="text-sm text-gray-500">Pay securely with your card</div>
                            </div>
                            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 8v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2z"/>
                            </svg>
                        </label>
                    </div>
                    <div id="visa-payment-form" class="hidden mt-4 bg-white rounded-lg shadow p-4 border-2 border-blue-200">
                        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 8v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2z"/>
                            </svg>
                            Card Information
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Cardholder Name</label>
                                <input type="text" id="visa-card-name" placeholder="John Doe" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" maxlength="50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                                <input type="text" id="visa-card-number" placeholder="1234 5678 9012 3456" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" maxlength="19" oninput="formatCardNumber(this)">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                    <input type="text" id="visa-card-expiry" placeholder="MM/YY" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" maxlength="5" oninput="formatExpiryDate(this)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                                    <input type="text" id="visa-card-cvv" placeholder="123" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Billing Address</label>
                                <input type="text" id="visa-billing-address" placeholder="123 Main Street" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                                    <input type="text" id="visa-billing-city" placeholder="Amman" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ZIP Code</label>
                                    <input type="text" id="visa-billing-zip" placeholder="11118" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" maxlength="10">
                                </div>
                            </div>
                            <div class="flex items-center gap-2 p-3 bg-blue-50 rounded-lg">
                                <svg class="w-5 h-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                                <p class="text-xs text-blue-700">Your payment information is secure and encrypted</p>
                            </div>
                            <div class="flex items-center gap-2 pt-2">
                                <input type="checkbox" id="save-card-checkbox" class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <label for="save-card-checkbox" class="text-sm text-gray-700 cursor-pointer">Save this card for future use</label>
                            </div>
                            <div id="saved-cards-section" class="hidden mt-4 pt-4 border-t border-gray-200">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Or use a saved card</label>
                                <div id="saved-cards-list" class="space-y-2">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex justify-between mb-2">
                        <span>Subtotal</span>
                        <span id="edit-subtotal">JOD 12.99</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span>Delivery</span>
                        <span>JOD 2.50</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg pt-2 border-t">
                        <span>Total</span>
                        <span class="text-red-600" id="edit-total">JOD 15.49</span>
                    </div>
                </div>
            </div>
            <div class="fixed bottom-16 left-0 right-0 max-w-md mx-auto bg-white border-t p-4 z-20">
                <button onclick="placeOrder()" class="w-full btn-primary text-white py-4 rounded-lg font-bold">Place Order - <span id="place-order-total">JOD 15.49</span></button>
            </div>
            <div class="h-32"></div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ORDER CONFIRMATION -->
        <div id="order-confirmation" class="screen">
            <div class="flex flex-col items-center justify-center min-h-screen p-8">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6">
                    <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold mb-2">Order Confirmed!</h1>
                <p class="text-gray-600 mb-8">Your meal is being prepared</p>
                <div class="w-full bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="text-center mb-4">
                        <span class="text-sm text-gray-500">Order Number</span>
                        <p class="text-2xl font-bold">#DH-2847</p>
                    </div>
                    <div class="border-t pt-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Delivery Time</span>
                            <span class="font-semibold">45-60 min</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Paid</span>
                            <span class="font-semibold">JOD 15.49</span>
                        </div>
                    </div>
                </div>
                <button onclick="if(lastOrderId) { trackOrder(lastOrderId); } else { showScreen('home-screen'); }" class="w-full btn-primary text-white py-3 rounded-lg font-semibold mb-3">Track Order</button>
                <button onclick="showScreen('home-screen')" class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-semibold mb-20">Back to Home</button>
            </div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- TRACK ORDER SCREEN -->
        <div id="track-order" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Track Order</h1>
                </div>
            </div>
            <div class="p-4 pb-20">
                <div id="track-order-content">
                    <!-- Order tracking will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- CHEFS LIST -->
        <div id="chefs-screen" class="screen">
            <div class="bg-white border-b sticky top-0">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Our Chefs</h1>
                </div>
            </div>
            <div class="p-4">
                <div id="chefs-grid" class="space-y-4"></div>
            </div>
        </div>

        <!-- MY ORDERS -->
        <div id="my-orders" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">My Orders</h1>
                </div>
            </div>
            <div class="p-4 pb-20">
                <div id="my-orders-list" class="space-y-4">
                    <!-- Orders will be dynamically added here -->
                </div>
            </div>
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1 active-tab">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- CHEF PROFILE -->
        <div id="chef-profile" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Chef Profile</h1>
                </div>
            </div>
            <div class="p-4">
                <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
                    <div class="flex items-center mb-4">
                        <img id="chef-profile-image" src="" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg">
                        <div class="ml-4 flex-1">
                            <h1 id="chef-profile-name" class="text-2xl font-bold text-gray-800"></h1>
                            <p id="chef-profile-specialty" class="text-gray-600 text-sm"></p>
                            <div class="flex items-center mt-1">
                                <span class="text-yellow-500"></span>
                                <span id="chef-profile-rating" class="text-sm font-semibold ml-1"></span>
                                <span class="text-gray-500 text-sm ml-2" id="chef-profile-reviews"></span>
                            </div>
                        </div>
                    </div>
                    <p id="chef-profile-bio" class="text-gray-600 text-sm mb-4"></p>
                    <div class="grid grid-cols-3 gap-3 pt-4 border-t">
                        <div class="text-center">
                            <div id="chef-profile-dishes" class="text-xl font-bold text-red-600"></div>
                            <div class="text-xs text-gray-500">Dishes</div>
                        </div>
                        <div class="text-center">
                            <div id="chef-profile-orders" class="text-xl font-bold text-green-600"></div>
                            <div class="text-xs text-gray-500">Orders</div>
                        </div>
                        <div class="text-center">
                            <div id="chef-profile-experience" class="text-xl font-bold text-blue-600"></div>
                            <div class="text-xs text-gray-500">Years</div>
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <button onclick="bookChefDirect()" class="w-full btn-primary text-white py-3 rounded-lg font-semibold shadow-lg">Book This Chef</button>
                </div>
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Chef's Dishes</h2>
                <div id="chef-dishes-grid" class="grid grid-cols-2 gap-4"></div>
                <div class="mt-6 pt-6 border-t">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Masterclasses</h2>
                    <div id="chef-masterclasses-list" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <!-- BOOK CHEF -->
        <div id="book-chef" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Book Chef</h1>
                </div>
            </div>
            <div class="p-4">
                <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
                    <div class="flex items-center mb-4">
                        <img id="book-chef-image" src="" class="w-16 h-16 rounded-full object-cover border-2 border-white shadow-lg">
                        <div class="ml-4 flex-1">
                            <h1 id="book-chef-name" class="text-xl font-bold text-gray-800"></h1>
                            <p id="book-chef-specialty" class="text-gray-600 text-sm"></p>
                            <div class="flex items-center mt-1">
                                <span class="text-yellow-500"></span>
                                <span id="book-chef-rating" class="text-sm font-semibold ml-1"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Booking Details</h3>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Service Type</label>
                        <select id="chef-service-type" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="catering">Catering Service</option>
                            <option value="private-dining">Private Dining</option>
                            <option value="cooking-lesson">Personal Cooking Lesson</option>
                            <option value="event">Event Catering</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="chef-booking-date" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                        <select id="chef-booking-time" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="">Select time</option>
                            <option value="10:00 AM">10:00 AM</option>
                            <option value="12:00 PM">12:00 PM</option>
                            <option value="2:00 PM">2:00 PM</option>
                            <option value="4:00 PM">4:00 PM</option>
                            <option value="6:00 PM">6:00 PM</option>
                            <option value="8:00 PM">8:00 PM</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Duration (hours)</label>
                        <select id="chef-booking-duration" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="4">4 hours</option>
                            <option value="5">5 hours</option>
                            <option value="6">6+ hours</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Guests</label>
                        <input type="number" id="chef-booking-guests" min="1" max="50" value="1" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Location</h3>
                    <input type="text" id="chef-booking-location" placeholder="Enter event/service location" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="font-semibold mb-3">Special Requests</h3>
                    <textarea id="chef-booking-notes" placeholder="Any special dietary requirements or requests..." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 h-24"></textarea>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mt-4">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Estimated Total</span>
                        <span id="chef-booking-total" class="text-xl font-bold text-red-600">JOD 150</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Final price may vary based on requirements</p>
                </div>
            </div>
            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t p-4">
                <button onclick="submitChefBooking()" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">Request Booking</button>
            </div>
            <div class="h-24"></div>
        </div>

        <!-- MASTERCLASSES -->
        <div id="masterclasses-screen" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Masterclasses</h1>
                </div>
            </div>
            <div class="p-4 pb-20">
                <div id="masterclasses-list" class="space-y-4">
                    <!-- Masterclasses will be dynamically added here -->
                </div>
            </div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- MASTERCLASS DETAIL -->
        <div id="masterclass-detail" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">Book Masterclass</h1>
                </div>
            </div>
            <div class="p-4">
                <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
                    <div class="flex items-center mb-4">
                        <img id="masterclass-chef-image" src="" class="w-16 h-16 rounded-full object-cover border-2 border-white shadow-lg">
                        <div class="ml-4 flex-1">
                            <h1 id="masterclass-title" class="text-xl font-bold text-gray-800"></h1>
                            <p id="masterclass-chef-name" class="text-gray-600 text-sm"></p>
                            <div class="flex items-center mt-1">
                                <span class="text-yellow-500"></span>
                                <span id="masterclass-rating" class="text-sm font-semibold ml-1"></span>
                            </div>
                        </div>
                    </div>
                    <p id="masterclass-description" class="text-gray-600 text-sm mb-4"></p>
                    <div class="grid grid-cols-2 gap-3 pt-4 border-t">
                        <div>
                            <div class="text-xs text-gray-500">Duration</div>
                            <div id="masterclass-duration" class="text-sm font-semibold text-gray-800"></div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500">Price</div>
                            <div id="masterclass-price" class="text-sm font-semibold text-red-600"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Select Date & Time</h3>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="masterclass-date" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                        <select id="masterclass-time" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="">Select time</option>
                            <option value="10:00 AM">10:00 AM</option>
                            <option value="2:00 PM">2:00 PM</option>
                            <option value="6:00 PM">6:00 PM</option>
                        </select>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Total</span>
                        <span id="masterclass-total" class="text-xl font-bold text-red-600"></span>
                    </div>
                </div>
            </div>
            <div class="fixed bottom-16 left-0 right-0 max-w-md mx-auto bg-white border-t p-4 z-20">
                <button onclick="bookMasterclass()" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">Book Masterclass</button>
            </div>
            <div class="h-32"></div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- MY BOOKINGS -->
        <div id="my-bookings" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">My Bookings</h1>
                </div>
            </div>
            <div class="p-4 pb-20">
                <div id="my-bookings-list" class="space-y-4">
                    <!-- Bookings will be dynamically added here -->
                </div>
            </div>
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1 active-tab">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- FAVORITES -->
        <div id="favorites-screen" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">My Favorites</h1>
                </div>
            </div>
            <div class="p-4 pb-20">
                <div id="favorites-list" class="grid grid-cols-2 gap-4">
                    <!-- Favorites will be dynamically added here -->
                </div>
            </div>
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative active-tab">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- PROFILE -->
        <div id="profile-screen" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4 flex items-center">
                    <button onclick="goBack()" class="mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold">My Profile</h1>
                </div>
            </div>
            <div class="p-4">
                <div class="bg-white rounded-lg shadow p-6 mb-4">
                    <div class="flex items-center mb-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-red-600 to-red-700 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-2xl" id="profile-initial">N</span>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-xl font-bold text-gray-800" id="profile-name">Noor A.</h2>
                            <p class="text-sm text-gray-500" id="profile-email">Customer</p>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2 border-b">
                            <span class="text-gray-600">Total Orders</span>
                            <span class="font-semibold" id="profile-total-orders">0</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b">
                            <span class="text-gray-600">Total Spent</span>
                            <span class="font-semibold text-red-600" id="profile-total-spent">JOD 0.00</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b">
                            <span class="text-gray-600">Favorite Dishes</span>
                            <span class="font-semibold" id="profile-favorites-count">0</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-gray-600">Member Since</span>
                            <span class="font-semibold">2024</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="font-semibold mb-3">Default Delivery Address</h3>
                    <input type="text" id="profile-address" placeholder="Enter your address" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    <button onclick="saveProfile()" class="w-full mt-3 btn-primary text-white py-2 rounded-lg font-semibold text-sm">Save Address</button>
                </div>
            </div>
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1 active-tab">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="admin-dashboard" class="screen">
            <div class="bg-white border-b sticky top-0 z-10">
                <div class="px-4 py-4">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">Admin Dashboard</h1>
                            <p class="text-sm text-gray-500">Platform Management</p>
                        </div>
                        <button onclick="logout()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div class="bg-blue-50 rounded-lg p-3 text-center border border-blue-100">
                            <div class="text-2xl font-bold text-blue-600" id="admin-total-dishes">0</div>
                            <div class="text-xs text-gray-600 mt-1">Total Dishes</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3 text-center border border-green-100">
                            <div class="text-2xl font-bold text-green-600" id="admin-total-chefs">0</div>
                            <div class="text-xs text-gray-600 mt-1">Total Chefs</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-3 text-center border border-purple-100">
                            <div class="text-2xl font-bold text-purple-600" id="admin-total-orders">0</div>
                            <div class="text-xs text-gray-600 mt-1">Total Orders</div>
                        </div>
                    </div>
                    <div class="flex space-x-2 border-b">
                        <button onclick="showAdminTab('dishes')" id="admin-tab-dishes" class="flex-1 px-4 py-2 text-sm font-semibold border-b-2 border-red-600 text-red-600 transition-colors">Dishes</button>
                        <button onclick="showAdminTab('chefs')" id="admin-tab-chefs" class="flex-1 px-4 py-2 text-sm font-semibold text-gray-500 border-b-2 border-transparent hover:text-red-600 transition-colors">Chefs</button>
                    </div>
                </div>
            </div>
            <div id="admin-dishes-container" class="p-4 pb-24"></div>
            <div id="admin-chefs-container" class="p-4 hidden pb-24"></div>
        </div>

        <!-- CHEF DASHBOARD -->
        <div id="chef-dashboard" class="screen">
            <div class="bg-white border-b sticky top-0">
                <div class="px-4 py-4">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <h1 id="chef-dashboard-name" class="text-xl font-bold">Chef Dashboard</h1>
                            <p class="text-sm text-gray-500">Dashboard</p>
                        </div>
                        <button onclick="logout()" class="p-2 hover:bg-gray-100 rounded-full">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        <div class="bg-blue-50 rounded-lg p-3 text-center border border-blue-100">
                            <div id="stats-pending" class="text-xl font-bold text-blue-600">0</div>
                            <div class="text-xs text-gray-600 mt-1">Pending</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3 text-center border border-green-100">
                            <div id="stats-today" class="text-xl font-bold text-green-600">JOD 0</div>
                            <div class="text-xs text-gray-600 mt-1">Today</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-3 text-center border border-purple-100">
                            <div id="stats-week" class="text-xl font-bold text-purple-600">JOD 0</div>
                            <div class="text-xs text-gray-600 mt-1">Week</div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-3 text-center border border-orange-100">
                            <div id="stats-month" class="text-xl font-bold text-orange-600">JOD 0</div>
                            <div class="text-xs text-gray-600 mt-1">Month</div>
                        </div>
                    </div>
                    <div class="flex space-x-2 border-b">
                        <button onclick="showChefTab('orders')" id="chef-tab-orders" class="flex-1 px-4 py-2 text-sm font-semibold border-b-2 border-red-600 text-red-600">Orders</button>
                        <button onclick="showChefTab('bookings')" id="chef-tab-bookings" class="flex-1 px-4 py-2 text-sm font-semibold text-gray-500 border-b-2 border-transparent">Bookings</button>
                        <button onclick="showChefTab('menu')" id="chef-tab-menu" class="flex-1 px-4 py-2 text-sm font-semibold text-gray-500 border-b-2 border-transparent">Menu</button>
                        <button onclick="showChefTab('analytics')" id="chef-tab-analytics" class="flex-1 px-4 py-2 text-sm font-semibold text-gray-500 border-b-2 border-transparent">Analytics</button>
                    </div>
                </div>
            </div>
            <div id="orders-container" class="p-4"></div>
            <div id="bookings-container" class="p-4 hidden"></div>
            <div id="menu-container" class="p-4 hidden">
                <div class="mb-4">
                    <button onclick="showAddDishModal()" class="btn-primary text-white px-4 py-2 rounded-lg font-semibold text-sm">+ Add New Dish</button>
                </div>
                <div id="chef-menu-list" class="space-y-4">
                    <!-- Chef's dishes will be displayed here -->
                </div>
            </div>
            <div id="analytics-container" class="p-4 hidden pb-24">
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 mb-4 text-white">
                    <h3 class="font-semibold mb-1 text-white text-opacity-90">Total Earnings</h3>
                    <div class="text-4xl font-bold text-white" id="analytics-total">JOD 0.00</div>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                        <div class="text-sm text-gray-600 mb-1">Today</div>
                        <div class="text-2xl font-bold text-green-600" id="analytics-today">JOD 0.00</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
                        <div class="text-sm text-gray-600 mb-1">This Week</div>
                        <div class="text-2xl font-bold text-purple-600" id="analytics-week">JOD 0.00</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                        <div class="text-sm text-gray-600 mb-1">This Month</div>
                        <div class="text-2xl font-bold text-blue-600" id="analytics-month">JOD 0.00</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-orange-500">
                        <div class="text-sm text-gray-600 mb-1">Avg Order</div>
                        <div class="text-2xl font-bold text-orange-600" id="analytics-avg-order">JOD 0.00</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
                    <h3 class="font-semibold mb-4 text-gray-800">Order Statistics</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-3 bg-gray-50 rounded-lg px-3">
                            <span class="text-gray-700 font-medium">Total Orders</span>
                            <span class="font-bold text-lg text-gray-800" id="analytics-total-orders">0</span>
                        </div>
                        <div class="flex justify-between items-center py-3 bg-green-50 rounded-lg px-3">
                            <span class="text-gray-700 font-medium">Completed</span>
                            <span class="font-bold text-lg text-green-600" id="analytics-completed">0</span>
                        </div>
                        <div class="flex justify-between items-center py-3 bg-blue-50 rounded-lg px-3">
                            <span class="text-gray-700 font-medium">Pending</span>
                            <span class="font-bold text-lg text-blue-600" id="analytics-pending">0</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="font-semibold mb-4 text-gray-800">Most Popular Dish</h3>
                    <div class="bg-gradient-to-r from-red-50 to-orange-50 rounded-lg p-4 border border-red-100">
                        <div class="text-2xl font-bold text-red-600 mb-1" id="analytics-popular-dish">-</div>
                        <div class="text-sm text-gray-600" id="analytics-popular-count">No orders yet</div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Tab Navigation -->
            <div id="bottom-tabs" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 z-50">
                <div class="flex items-center justify-around py-2">
                    <button onclick="navigateToTab('home')" id="tab-home" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs">Home</span>
                    </button>
                    <button onclick="navigateToTab('favorites')" id="tab-favorites" class="flex flex-col items-center justify-center px-4 py-2 flex-1 relative">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="text-xs">Favorites</span>
                        <span id="tab-favorites-count" class="absolute top-1 right-2 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="navigateToTab('bookings')" id="tab-bookings" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-xs">Bookings</span>
                    </button>
                    <button onclick="navigateToTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="text-xs">Orders</span>
                    </button>
                    <button onclick="navigateToTab('profile')" id="tab-profile" class="flex flex-col items-center justify-center px-4 py-2 flex-1">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- VIDEO/AUDIO CALL -->
        <div id="call-screen" class="screen">
            <div class="bg-black min-h-screen flex flex-col">
                <div class="bg-gray-900 px-4 py-4 flex items-center justify-between">
                    <button onclick="endCall()" class="p-2 hover:bg-gray-800 rounded-full">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <div class="text-center flex-1">
                        <h1 id="call-participant-name" class="text-white font-semibold"></h1>
                        <p id="call-status" class="text-gray-400 text-sm">Connecting...</p>
                    </div>
                    <div class="w-10"></div>
                </div>
                <div class="flex-1 flex items-center justify-center relative">
                    <video id="remote-video" autoplay playsinline class="w-full h-full object-cover"></video>
                    <video id="local-video" autoplay playsinline muted class="absolute bottom-4 right-4 w-32 h-40 rounded-lg object-cover border-2 border-white shadow-lg"></video>
                    <div id="call-audio-only" class="hidden flex flex-col items-center justify-center w-full h-full">
                        <div class="w-32 h-32 bg-red-600 rounded-full flex items-center justify-center mb-4">
                            <span id="call-participant-initial" class="text-white font-bold text-4xl"></span>
                        </div>
                        <p id="call-participant-name-audio" class="text-white text-xl font-semibold"></p>
                    </div>
                </div>
                <div class="bg-gray-900 px-4 py-6">
                    <div class="flex items-center justify-center space-x-6">
                        <button id="toggle-mute" onclick="toggleMute()" class="w-14 h-14 rounded-full bg-gray-700 hover:bg-gray-600 flex items-center justify-center transition">
                            <svg id="mic-icon" class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                            </svg>
                        </button>
                        <button id="toggle-video" onclick="toggleVideo()" class="w-14 h-14 rounded-full bg-gray-700 hover:bg-gray-600 flex items-center justify-center transition">
                            <svg id="video-icon" class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                        </button>
                        <button onclick="endCall()" class="w-14 h-14 rounded-full bg-red-600 hover:bg-red-700 flex items-center justify-center transition">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M7 8H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V10a2 2 0 00-2-2h-2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <!-- CUSTOM ALERT MODAL -->
    <div id="custom-alert" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4" onclick="if(event.target === this) closeCustomAlert()">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full transform transition-all" onclick="event.stopPropagation()">
            <div class="p-6">
                <div id="alert-icon" class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h3 id="alert-title" class="text-xl font-bold text-gray-800 text-center mb-2"></h3>
                <p id="alert-message" class="text-gray-600 text-center mb-6 whitespace-pre-line"></p>
                <div id="alert-buttons">
                    <button onclick="closeCustomAlert()" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="custom-confirm" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4" onclick="if(event.target === this) closeCustomConfirm()">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full transform transition-all" onclick="event.stopPropagation()">
            <div class="p-6">
                <div id="confirm-icon" class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-yellow-100 text-yellow-600">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h3 id="confirm-title" class="text-xl font-bold text-gray-800 text-center mb-2">Confirm Action</h3>
                <p id="confirm-message" class="text-gray-600 text-center mb-6 whitespace-pre-line"></p>
                <div class="flex gap-3">
                    <button onclick="closeCustomConfirm()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">Cancel</button>
                    <button id="confirm-ok-btn" onclick="executeConfirmAction()" class="flex-1 btn-primary text-white py-3 rounded-lg font-semibold">Confirm</button>
                </div>
            </div>
        </div>
    </div>

        <!-- ADD DISH MODAL -->
        <div id="add-dish-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" style="display: none;">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[95vh] flex flex-col">
                <div class="flex justify-between items-center p-6 border-b border-gray-200 flex-shrink-0">
                    <h2 id="dish-modal-title" class="text-2xl font-bold text-gray-800">Add New Dish</h2>
                    <button onclick="closeAddDishModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="overflow-y-auto flex-1 px-6 py-4">
                        <form id="dish-form" onsubmit="event.preventDefault(); if(currentEditingDishId) { updateDishAdmin(currentEditingDishId); } else { saveNewDishAdmin(); }" class="space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Dish Name *</label>
                                <input type="text" id="new-dish-name" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Price (JOD) *</label>
                                <input type="number" id="new-dish-price" step="0.01" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Category *</label>
                                <select id="new-dish-category" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                                    <option value="middle-eastern">Middle Eastern</option>
                                    <option value="italian">Italian</option>
                                    <option value="asian">Asian</option>
                                    <option value="desserts">Desserts</option>
                                </select>
                            </div>
                            <div id="admin-chef-selector" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Chef *</label>
                                <select id="new-dish-chef" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Image URL</label>
                            <input type="text" id="new-dish-image" placeholder="https://..." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Rating</label>
                            <input type="number" id="new-dish-rating" step="0.1" min="0" max="5" value="4.5" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                        </div>
                        <div id="dish-ingredients-section" class="hidden border-t border-gray-200 pt-5 mt-5">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">Dish Ingredients</h3>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <span id="ingredient-count-add" class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full font-medium">0 add</span>
                                    <span id="ingredient-count-remove" class="px-2 py-1 bg-orange-100 text-orange-700 rounded-full font-medium">0 remove</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200">
                                    <div class="flex items-center justify-between mb-3">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-800">Add Ingredients</label>
                                            <p class="text-xs text-gray-500 mt-0.5">Extra items customers can add</p>
                                        </div>
                                        <button type="button" onclick="addIngredientToDish('add')" class="px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-xs font-semibold rounded-lg transition-colors flex items-center gap-1 shadow-sm">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Add
                                        </button>
                                    </div>
                                    <div id="dish-add-ingredients-list" class="space-y-2 max-h-64 overflow-y-auto pr-1">
                                        <p class="text-xs text-gray-400 text-center py-4">No ingredients added</p>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200">
                                    <div class="flex items-center justify-between mb-3">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-800">Remove Ingredients</label>
                                            <p class="text-xs text-gray-500 mt-0.5">Items customers can remove</p>
                                        </div>
                                        <button type="button" onclick="addIngredientToDish('remove')" class="px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-xs font-semibold rounded-lg transition-colors flex items-center gap-1 shadow-sm">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Add
                                        </button>
                                    </div>
                                    <div id="dish-remove-ingredients-list" class="space-y-2 max-h-64 overflow-y-auto pr-1">
                                        <p class="text-xs text-gray-400 text-center py-4">No ingredients to remove</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="flex gap-3 p-6 border-t border-gray-200 flex-shrink-0">
                    <button type="button" onclick="closeAddDishModal()" class="flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-semibold transition-colors">Cancel</button>
                    <button type="button" onclick="if(currentEditingDishId) { updateDishAdmin(currentEditingDishId); } else { saveNewDishAdmin(); }" id="dish-modal-submit" class="flex-1 btn-primary text-white py-3 rounded-lg font-semibold">Add Dish</button>
                </div>
            </div>
        </div>

        <!-- ADD INGREDIENT TO DISH MODAL -->
        <div id="add-ingredient-to-dish-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" style="display: none;">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800">Add Ingredient</h2>
                    <button onclick="closeAddIngredientToDishModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <form onsubmit="event.preventDefault(); saveIngredientToDish();" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ingredient Name *</label>
                        <input type="text" id="new-dish-ingredient-name" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                    </div>
                    <div id="ingredient-price-field" class="hidden">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Price (JOD) *</label>
                        <input type="number" id="new-dish-ingredient-price" step="0.01" min="0" value="0.50" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="closeAddIngredientToDishModal()" class="flex-1 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-semibold transition-colors">Cancel</button>
                        <button type="submit" class="flex-1 btn-primary text-white py-2.5 rounded-lg font-semibold">Add</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- EDIT INGREDIENT PRICE MODAL -->
        <div id="edit-ingredient-price-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" style="display: none;">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800">Edit Ingredient Price</h2>
                    <button onclick="closeEditIngredientPriceModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <form onsubmit="event.preventDefault(); saveIngredientPrice();" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ingredient</label>
                        <div class="px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm font-medium text-gray-800" id="edit-ingredient-price-name"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Price (JOD) *</label>
                        <input type="number" id="edit-ingredient-price-value" step="0.01" min="0" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="closeEditIngredientPriceModal()" class="flex-1 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-semibold transition-colors">Cancel</button>
                        <button type="submit" class="flex-1 btn-primary text-white py-2.5 rounded-lg font-semibold">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- EDIT CHEF MODAL -->
        <div id="edit-chef-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center" style="display: none;">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold" id="edit-chef-modal-title">Edit Chef</h2>
                    <button onclick="closeEditChefModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <form onsubmit="event.preventDefault(); saveChefEdit();" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Chef Name</label>
                        <input type="text" id="edit-chef-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kitchen Name</label>
                        <input type="text" id="edit-chef-kitchen" required class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Specialty</label>
                        <input type="text" id="edit-chef-specialty" required class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Rating (0-5)</label>
                        <input type="number" id="edit-chef-rating" step="0.1" min="0" max="5" required class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Reviews</label>
                        <input type="text" id="edit-chef-reviews" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
                        <textarea id="edit-chef-bio" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                        <input type="text" id="edit-chef-image" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="flex gap-2">
                        <button type="button" onclick="closeEditChefModal()" class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold">Cancel</button>
                        <button type="submit" class="flex-1 btn-primary text-white py-2 rounded-lg font-semibold">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const dishes = {
            all: [
                {id: 1, name: 'Traditional Mansaf', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 9.50', rating: '4.8', image: 'mansaf.jpg', category: 'middle-eastern', customIngredients: { add: [{ name: 'Extra Rice', price: 0.75 }, { name: 'Extra Meat', price: 1.00 }, { name: 'Yogurt', price: 0.50 }], remove: ['Onions', 'Garlic'] }},
                {id: 2, name: 'Sweet Kunafa', chef: "Ahmad's Sweets", chefId: 'ahmad', price: 'JOD 4.50', rating: '5.0', image: 'kunafa.jpg', category: 'desserts'},
                {id: 3, name: 'Dolma', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 4.50', rating: '4.7', image: 'dolma.jpg', category: 'middle-eastern', customIngredients: { add: [], remove: [] }},
                {id: 4, name: 'Galaye', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 7.50', rating: '4.9', image: 'galaye.jpg', category: 'middle-eastern', customIngredients: { add: [], remove: [] }},
                {id: 16, name: 'Kusa', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 6.00', rating: '4.8', image: 'kusa.jpg', category: 'middle-eastern', customIngredients: { add: [], remove: [] }},
                {id: 5, name: 'Margherita Pizza', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 8.50', rating: '4.8', image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=400&q=80&fit=crop', category: 'italian', customIngredients: { add: [{ name: 'Extra Cheese', price: 0.75 }, { name: 'Pepperoni', price: 1.00 }, { name: 'Mushrooms', price: 0.60 }], remove: ['Onions'] }},
                {id: 6, name: 'Spaghetti Carbonara', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 7.50', rating: '4.9', image: 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?w=400&q=80&fit=crop', category: 'italian', customIngredients: { add: [], remove: [] }},
                {id: 7, name: 'Chicken Parmesan', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 9.50', rating: '4.7', image: 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400&q=80&fit=crop', category: 'italian', customIngredients: { add: [], remove: [] }},
                {id: 8, name: 'Pad Thai', chef: "Chef Ali's Asian Kitchen", chefId: 'ali', price: 'JOD 7.00', rating: '4.9', image: 'pad.jpg', category: 'asian', customIngredients: { add: [{ name: 'Extra Vegetables', price: 0.65 }, { name: 'Extra Shrimp', price: 1.25 }, { name: 'Chili Sauce', price: 0.30 }], remove: ['Peanuts', 'Eggs'] }},
                {id: 9, name: 'Sushi Platter', chef: "Chef Ali's Asian Kitchen", chefId: 'ali', price: 'JOD 12.00', rating: '5.0', image: 'sushi.jpg', category: 'asian', customIngredients: { add: [], remove: [] }},
                {id: 10, name: 'Chicken Teriyaki', chef: "Chef Ali's Asian Kitchen", chefId: 'ali', price: 'JOD 6.50', rating: '4.8', image: 'chickent.jpg', category: 'asian', customIngredients: { add: [], remove: [] }},
                {id: 11, name: 'Kabseh', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 9.00', rating: '4.9', image: 'kabseh.jpg', category: 'middle-eastern', customIngredients: { add: [], remove: [] }},
                {id: 12, name: 'Mandi', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 10.50', rating: '4.8', image: 'mandi.jpg', category: 'middle-eastern'},
                {id: 14, name: 'Baklava', chef: "Ahmad's Sweets", chefId: 'ahmad', price: 'JOD 4.00', rating: '5.0', image: 'baklava.jpg', category: 'desserts'},
                {id: 15, name: 'Tiramisu', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 5.00', rating: '4.9', image: 'tiramisu.jpg', category: 'desserts'}
            ],
            'middle-eastern': [
                {id: 1, name: 'Traditional Mansaf', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 9.50', rating: '4.8', image: 'mansaf.jpg', category: 'middle-eastern'},
                {id: 3, name: 'Dolma', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 4.50', rating: '4.7', image: 'dolma.jpg', category: 'middle-eastern'},
                {id: 4, name: 'Galaye', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 7.50', rating: '4.9', image: 'galaye.jpg', category: 'middle-eastern'},
                {id: 11, name: 'Kabseh', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 9.00', rating: '4.9', image: 'kabseh.jpg', category: 'middle-eastern'},
                {id: 12, name: 'Mandi', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 10.50', rating: '4.8', image: 'mandi.jpg', category: 'middle-eastern'},
                {id: 16, name: 'Kusa', chef: "Chef Layla's Kitchen", chefId: 'layla', price: 'JOD 6.00', rating: '4.8', image: 'kusa.jpg', category: 'middle-eastern'}
            ],
            italian: [
                {id: 5, name: 'Margherita Pizza', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 8.50', rating: '4.8', image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=400&q=80&fit=crop', category: 'italian'},
                {id: 6, name: 'Spaghetti Carbonara', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 7.50', rating: '4.9', image: 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?w=400&q=80&fit=crop', category: 'italian'},
                {id: 7, name: 'Chicken Parmesan', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 9.50', rating: '4.7', image: 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400&q=80&fit=crop', category: 'italian'}
            ],
            asian: [
                {id: 8, name: 'Pad Thai', chef: "Chef Ali's Asian Kitchen", chefId: 'ali', price: 'JOD 7.00', rating: '4.9', image: 'pad.jpg', category: 'asian'},
                {id: 9, name: 'Sushi Platter', chef: "Chef Ali's Asian Kitchen", chefId: 'ali', price: 'JOD 12.00', rating: '5.0', image: 'sushi.jpg', category: 'asian'},
                {id: 10, name: 'Chicken Teriyaki', chef: "Chef Ali's Asian Kitchen", chefId: 'ali', price: 'JOD 6.50', rating: '4.8', image: 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400&q=80&fit=crop', category: 'asian'}
            ],
            mexican: [
            ],
            desserts: [
                {id: 2, name: 'Sweet Kunafa', chef: "Ahmad's Sweets", chefId: 'ahmad', price: 'JOD 4.50', rating: '5.0', image: 'kunafa.jpg', category: 'desserts'},
                {id: 14, name: 'Baklava', chef: "Ahmad's Sweets", chefId: 'ahmad', price: 'JOD 4.00', rating: '5.0', image: 'baklava.jpg', category: 'desserts'},
                {id: 15, name: 'Tiramisu', chef: "Chef Omar's Italian", chefId: 'omar', price: 'JOD 5.00', rating: '4.9', image: 'tiramisu.jpg', category: 'desserts'}
            ]
        };

        // Ingredients data structure (managed by admin)
        let ingredientsData = {
            'middle-eastern': {
                add: ['Extra Rice', 'Extra Meat', 'Tahini Sauce', 'Garlic Sauce', 'Pickles', 'Olives', 'Pita Bread', 'Yogurt'],
                remove: ['Onions', 'Garlic', 'Tomatoes', 'Peppers', 'Nuts', 'Dairy']
            },
            'italian': {
                add: ['Extra Cheese', 'Mushrooms', 'Olives', 'Pepperoni', 'Basil', 'Garlic Bread'],
                remove: ['Onions', 'Garlic', 'Tomatoes', 'Cheese', 'Mushrooms']
            },
            'asian': {
                add: ['Extra Rice', 'Extra Vegetables', 'Soy Sauce', 'Chili Sauce', 'Ginger', 'Spring Onions'],
                remove: ['Peanuts', 'Sesame', 'Soy', 'Shellfish', 'Eggs']
            },
            'desserts': {
                add: ['Extra Whipped Cream', 'Chocolate Sauce', 'Caramel', 'Nuts', 'Berries'],
                remove: ['Nuts', 'Dairy', 'Eggs', 'Gluten']
            }
        };

        // Load ingredients from localStorage if available
        const savedIngredients = localStorage.getItem('ingredientsData');
        if (savedIngredients) {
            try {
                ingredientsData = JSON.parse(savedIngredients);
            } catch (e) {
                // Keep default if parsing fails
            }
        }

        const chefs = [
            {
                id: 'layla',
                name: 'Chef Layla',
                kitchen: "Chef Layla's Kitchen",
                specialty: 'Middle Eastern Cuisine',
                rating: '4.8',
                reviews: '234 reviews',
                bio: 'Passionate about authentic Middle Eastern flavors. 15 years of experience bringing traditional recipes to life.',
                image: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=400',
                dishes: 3,
                orders: 1200,
                experience: 15
            },
            {
                id: 'ahmad',
                name: 'Chef Ahmad',
                kitchen: "Ahmad's Sweets",
                specialty: 'Desserts & Pastries',
                rating: '5.0',
                reviews: '189 reviews',
                bio: 'Master pastry chef specializing in Middle Eastern and international desserts. Every bite is a sweet journey.',
                image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400',
                dishes: 3,
                orders: 890,
                experience: 12
            },
            {
                id: 'omar',
                name: 'Chef Omar',
                kitchen: "Chef Omar's Italian",
                specialty: 'Italian Cuisine',
                rating: '4.9',
                reviews: '312 reviews',
                bio: 'Born in Italy, raised with authentic recipes. Bringing the taste of Italy to your table with passion and tradition.',
                image: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400',
                dishes: 4,
                orders: 1500,
                experience: 20
            },
            {
                id: 'ali',
                name: 'Chef Ali',
                kitchen: "Chef Ali's Asian Kitchen",
                specialty: 'Asian Fusion',
                rating: '4.9',
                reviews: '278 reviews',
                bio: 'Expert in Asian cuisine with a modern twist. Combining traditional techniques with innovative flavors.',
                image: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400',
                dishes: 3,
                orders: 1100,
                experience: 18
            },
            {
                id: 'fatima',
                name: 'Chef Fatima',
                kitchen: "Chef Fatima's Kitchen",
                specialty: 'Middle Eastern Cuisine',
                rating: '4.7',
                reviews: '156 reviews',
                bio: 'Authentic Middle Eastern flavors with family recipes passed down through generations. Spice up your day!',
                image: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400',
                dishes: 2,
                orders: 650,
                experience: 10
            }
        ];

        const masterclasses = [
            {
                id: 'mc1',
                chefId: 'layla',
                title: 'Authentic Middle Eastern Cooking',
                description: 'Learn to prepare traditional Middle Eastern dishes including Mansaf, Dolma, and more. Hands-on experience with authentic techniques.',
                duration: '3 hours',
                price: 'JOD 75',
                rating: '4.9',
                chefName: 'Chef Layla',
                chefImage: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=400'
            },
            {
                id: 'mc2',
                chefId: 'ahmad',
                title: 'Dessert Mastery Workshop',
                description: 'Master the art of Middle Eastern desserts. Learn to make perfect Kunafa, Baklava, and other sweet delicacies.',
                duration: '2.5 hours',
                price: 'JOD 65',
                rating: '5.0',
                chefName: 'Chef Ahmad',
                chefImage: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400'
            },
            {
                id: 'mc3',
                chefId: 'omar',
                title: 'Italian Pasta & Pizza Making',
                description: 'Discover the secrets of authentic Italian cuisine. Learn to make fresh pasta and wood-fired pizza from scratch.',
                duration: '3.5 hours',
                price: 'JOD 85',
                rating: '4.8',
                chefName: 'Chef Omar',
                chefImage: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400'
            },
            {
                id: 'mc4',
                chefId: 'ali',
                title: 'Asian Fusion Techniques',
                description: 'Explore the art of Asian cooking with modern twists. Learn sushi making, stir-fry techniques, and flavor balancing.',
                duration: '3 hours',
                price: 'JOD 80',
                rating: '4.9',
                chefName: 'Chef Ali',
                chefImage: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400'
            },
            {
                id: 'mc5',
                chefId: 'fatima',
                title: 'Middle Eastern Cooking Masterclass',
                description: 'Learn to create authentic Middle Eastern cuisine. Master traditional recipes and cooking techniques.',
                duration: '2.5 hours',
                price: 'JOD 70',
                rating: '4.7',
                chefName: 'Chef Fatima',
                chefImage: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400'
            }
        ];

        let cart = [];
        let selectedPaymentMethod = 'cash';
        let savedCards = [];
        let myOrders = [];
        let myBookings = [];
        let favorites = [];
        let userProfile = {
            address: '',
            totalSpent: 0
        };
        let allChefBookings = [];
        let currentDishId = null;
        let currentMasterclassId = null;
        let currentChefId = null;
        let currentChefTab = 'orders';
        let lastOrderId = null;
        
        // Saved Cards Functions
        function loadSavedCards() {
            const saved = localStorage.getItem('savedCards');
            if (saved) {
                try {
                    savedCards = JSON.parse(saved);
                    renderSavedCards();
                } catch (e) {
                    savedCards = [];
                }
            } else {
                savedCards = [];
            }
        }
        
        function saveCardsToStorage() {
            localStorage.setItem('savedCards', JSON.stringify(savedCards));
        }
        
        function renderSavedCards() {
            const savedCardsSection = document.getElementById('saved-cards-section');
            const savedCardsList = document.getElementById('saved-cards-list');
            
            if (!savedCardsSection || !savedCardsList) return;
            
            if (savedCards.length > 0) {
                savedCardsSection.classList.remove('hidden');
                savedCardsList.innerHTML = savedCards.map((card, index) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg hover:border-blue-400 transition-colors cursor-pointer" onclick="selectSavedCard(${index})">
                        <div class="flex items-center gap-3">
                            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 8v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2z"/>
                            </svg>
                            <div>
                                <div class="font-semibold text-sm text-gray-800">${card.cardName}</div>
                                <div class="text-xs text-gray-500">${card.maskedCardNumber || '**** **** **** ' + card.cardNumber.slice(-4)}</div>
                                <div class="text-xs text-gray-400">Expires ${card.cardExpiry}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="event.stopPropagation(); deleteSavedCard(${index})" class="p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors" title="Delete">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                savedCardsSection.classList.add('hidden');
            }
        }
        
        function selectSavedCard(index) {
            const card = savedCards[index];
            if (!card) return;
            
            document.getElementById('visa-card-name').value = card.cardName;
            document.getElementById('visa-card-number').value = card.cardNumber;
            document.getElementById('visa-card-expiry').value = card.cardExpiry;
            document.getElementById('visa-card-cvv').value = card.cardCvv;
            document.getElementById('visa-billing-address').value = card.billingAddress || '';
            document.getElementById('visa-billing-city').value = card.billingCity || '';
            document.getElementById('visa-billing-zip').value = card.billingZip || '';
            
            // Uncheck save card checkbox when using saved card
            const saveCheckbox = document.getElementById('save-card-checkbox');
            if (saveCheckbox) saveCheckbox.checked = false;
        }
        
        function deleteSavedCard(index) {
            showCustomConfirm(
                'Are you sure you want to delete this saved card?',
                'Delete Card',
                () => {
                    savedCards.splice(index, 1);
                    saveCardsToStorage();
                    renderSavedCards();
                    showCustomAlert('Card deleted successfully!', 'Success', 'success');
                }
            );
        }

        // Custom Alert Functions
        function showCustomAlert(message, title = 'Notification', type = 'info') {
            const alert = document.getElementById('custom-alert');
            const alertTitle = document.getElementById('alert-title');
            const alertMessage = document.getElementById('alert-message');
            const alertIcon = document.getElementById('alert-icon');
            
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            
            // Set icon and color based on type
            alertIcon.className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center';
            if (type === 'success') {
                alertIcon.classList.add('bg-green-100', 'text-green-600');
                alertIcon.innerHTML = '<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
            } else if (type === 'error') {
                alertIcon.classList.add('bg-red-100', 'text-red-600');
                alertIcon.innerHTML = '<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
            } else {
                alertIcon.classList.add('bg-blue-100', 'text-blue-600');
                alertIcon.innerHTML = '<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            }
            
            alert.classList.remove('hidden');
        }

        function closeCustomAlert() {
            document.getElementById('custom-alert').classList.add('hidden');
        }

        // Custom Confirmation Modal
        let confirmCallback = null;

        function showCustomConfirm(message, title = 'Confirm Action', onConfirm) {
            const confirm = document.getElementById('custom-confirm');
            const confirmTitle = document.getElementById('confirm-title');
            const confirmMessage = document.getElementById('confirm-message');
            
            confirmTitle.textContent = title;
            confirmMessage.textContent = message;
            confirmCallback = onConfirm;
            
            confirm.classList.remove('hidden');
        }

        function closeCustomConfirm() {
            document.getElementById('custom-confirm').classList.add('hidden');
            confirmCallback = null;
        }

        function executeConfirmAction() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeCustomConfirm();
        }

        // Cancel Booking Function
        function cancelBooking(bookingId) {
            const booking = myBookings.find(b => b.id === bookingId);
            if (!booking) return;
            
            if (booking.status === 'cancelled' || booking.status === 'rejected') {
                showCustomAlert('This booking is already cancelled or rejected.', 'Cannot Cancel', 'error');
                return;
            }
            
            showCustomConfirm(
                `Are you sure you want to cancel this booking?\n\nBooking: ${booking.title}\nDate: ${new Date(booking.date).toLocaleDateString()}\n\nThis action cannot be undone.`,
                'Cancel Booking',
                () => {
                    // Update booking status
                    booking.status = 'cancelled';
                    
                    // Update in allChefBookings array if it exists
                    const chefBooking = allChefBookings.find(b => b.id === bookingId);
                    if (chefBooking) {
                        chefBooking.status = 'cancelled';
                    }
                    
                    // Save to localStorage
                    saveBookingsToStorage();
                    
                    // Re-render bookings
                    renderMyBookings();
                    
                    // Show success message
                    showCustomAlert('Booking cancelled successfully.', 'Booking Cancelled', 'success');
                }
            );
        }

        // Login Persistence
        function saveLoginState(userType, username) {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userType', userType);
            localStorage.setItem('username', username);
        }

        function clearLoginState() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userType');
            localStorage.removeItem('username');
        }

        function checkLoginState() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userType = localStorage.getItem('userType');
            
            // Load bookings from localStorage
            const savedBookings = localStorage.getItem('myBookings');
            if (savedBookings) {
                try {
                    myBookings = JSON.parse(savedBookings);
                } catch (e) {
                    myBookings = [];
                }
            }
            
            const savedChefBookings = localStorage.getItem('allChefBookings');
            if (savedChefBookings) {
                try {
                    allChefBookings = JSON.parse(savedChefBookings);
                } catch (e) {
                    allChefBookings = [];
                }
            }
            
            const savedOrders = localStorage.getItem('myOrders');
            if (savedOrders) {
                try {
                    myOrders = JSON.parse(savedOrders);
                } catch (e) {
                    myOrders = [];
                }
            }
            
            loadFavorites();
            
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                try {
                    userProfile = JSON.parse(savedProfile);
                } catch (e) {}
            }
            
            if (isLoggedIn === 'true') {
                if (userType === 'customer') {
                    showScreen('home-screen');
                } else if (userType === 'chef') {
                    currentChefTab = 'orders';
                    showScreen('chef-dashboard');
                    renderOrders();
                    updateChefStats();
                } else if (userType === 'admin') {
                    showScreen('admin-dashboard');
                    renderAdminDashboard();
                }
            }
        }

        function saveBookingsToStorage() {
            localStorage.setItem('myBookings', JSON.stringify(myBookings));
            localStorage.setItem('allChefBookings', JSON.stringify(allChefBookings));
            localStorage.setItem('myOrders', JSON.stringify(myOrders));
        }

        const orders = [
            {id: 'DH-2847', customer: 'Noor A.', dish: 'Traditional Mansaf x2', total: 'JOD 28.48', status: 'pending', time: '5 min ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2846', customer: 'Sarah M.', dish: 'Sweet Kunafa', total: 'JOD 10.50', status: 'preparing', time: '15 min ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2845', customer: 'Ahmed K.', dish: 'Hummus & Pita, Shawarma Plate', total: 'JOD 20.99', status: 'pending', time: '25 min ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2844', customer: 'Fatima S.', dish: 'Margherita Pizza', total: 'JOD 17.49', status: 'preparing', time: '35 min ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2843', customer: 'Omar H.', dish: 'Pad Thai x2', total: 'JOD 28.48', status: 'done', time: '1 hour ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2842', customer: 'Layla M.', dish: 'Sushi Platter', total: 'JOD 21.49', status: 'done', time: '2 hours ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2841', customer: 'Yusuf A.', dish: 'Kabseh x2', total: 'JOD 30.48', status: 'done', time: '3 hours ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2840', customer: 'Mariam F.', dish: 'Spaghetti Carbonara', total: 'JOD 16.00', status: 'canceled', time: '4 hours ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2839', customer: 'Khalid R.', dish: 'Chicken Teriyaki, Baklava', total: 'JOD 20.99', status: 'done', time: '5 hours ago', date: new Date().toLocaleDateString()},
            {id: 'DH-2838', customer: 'Sara N.', dish: 'Mandi', total: 'JOD 17.00', status: 'done', time: '6 hours ago', date: new Date().toLocaleDateString()}
        ];

        let currentScreen = 'login-screen';
        let previousScreen = 'login-screen';

        function renderDishes(arr) {
            const grid = document.getElementById('content-grid');
            if (!grid) return;
            grid.innerHTML = arr.map(d => `
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="relative">
                        <img src="${d.image}" class="w-full h-32 object-cover cursor-pointer" onclick="viewDish(${d.id})">
                        <button onclick="event.stopPropagation(); toggleFavorite(${d.id})" class="absolute top-2 right-2 p-1.5 bg-white rounded-full shadow-lg hover:bg-gray-50">
                            <svg class="w-5 h-5 ${isFavorite(d.id) ? 'text-red-600 fill-current' : 'text-gray-400'}" fill="${isFavorite(d.id) ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold text-sm mb-1 cursor-pointer" onclick="viewDish(${d.id})">${d.name}</h3>
                        <p class="text-xs text-gray-500 mb-2">${d.chef}</p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-red-600">${d.price}</span>
                            <span class="text-xs"> ${d.rating}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderChefs() {
            const grid = document.getElementById('chefs-grid');
            if (!grid) return;
            grid.innerHTML = chefs.map(chef => `
                <div class="bg-white rounded-lg shadow p-4 cursor-pointer" onclick="viewChefProfile('${chef.id}')">
                    <div class="flex items-center">
                        <img src="${chef.image}" class="w-16 h-16 rounded-full object-cover">
                        <div class="ml-4 flex-1">
                            <h3 class="font-bold text-lg">${chef.name}</h3>
                            <p class="text-sm text-gray-500">${chef.kitchen}</p>
                            <p class="text-xs text-gray-400">${chef.specialty}</p>
                            <div class="flex items-center mt-1">
                                <span class="text-yellow-500"></span>
                                <span class="text-sm font-semibold ml-1">${chef.rating}</span>
                                <span class="text-gray-500 text-xs ml-2">${chef.reviews}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function viewChefProfile(chefId) {
            const chef = chefs.find(c => c.id === chefId);
            if (!chef) return;
            
            currentChefId = chefId;
            document.getElementById('chef-profile-image').src = chef.image;
            document.getElementById('chef-profile-name').textContent = chef.name;
            document.getElementById('chef-profile-specialty').textContent = chef.specialty;
            document.getElementById('chef-profile-rating').textContent = chef.rating;
            document.getElementById('chef-profile-reviews').textContent = chef.reviews;
            document.getElementById('chef-profile-bio').textContent = chef.bio;
            document.getElementById('chef-profile-dishes').textContent = chef.dishes;
            document.getElementById('chef-profile-orders').textContent = chef.orders;
            document.getElementById('chef-profile-experience').textContent = chef.experience;
            
            const chefDishes = dishes.all.filter(d => d.chefId === chefId);
            const dishesGrid = document.getElementById('chef-dishes-grid');
            dishesGrid.innerHTML = chefDishes.map(d => `
                <div class="bg-white rounded-lg shadow overflow-hidden cursor-pointer" onclick="viewDish(${d.id})">
                    <img src="${d.image}" class="w-full h-32 object-cover">
                    <div class="p-3">
                        <h3 class="font-semibold text-sm mb-1">${d.name}</h3>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-red-600">${d.price}</span>
                            <span class="text-xs"> ${d.rating}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            const chefMasterclasses = masterclasses.filter(m => m.chefId === chefId);
            const masterclassesList = document.getElementById('chef-masterclasses-list');
            if (masterclassesList) {
                if (chefMasterclasses.length === 0) {
                    masterclassesList.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">No masterclasses available</p>';
                } else {
                    masterclassesList.innerHTML = chefMasterclasses.map(m => `
                        <div class="bg-gray-50 rounded-lg p-3 cursor-pointer hover:bg-gray-100 transition" onclick="viewMasterclassDetail('${m.id}')">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-sm text-gray-800">${m.title}</h3>
                                    <p class="text-xs text-gray-500 mt-1">${m.duration}  ${m.price}</p>
                                </div>
                                <span class="text-xs text-yellow-500"> ${m.rating}</span>
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            previousScreen = 'chefs-screen';
            showScreen('chef-profile');
        }

        function showChefs() {
            renderChefs();
            previousScreen = 'home-screen';
            showScreen('chefs-screen');
        }

        function renderMasterclasses() {
            const list = document.getElementById('masterclasses-list');
            if (!list) return;
            
            list.innerHTML = masterclasses.map(m => {
                const chef = chefs.find(c => c.id === m.chefId);
                return `
                    <div class="bg-white rounded-lg shadow p-4 cursor-pointer" onclick="viewMasterclassDetail('${m.id}')">
                        <div class="flex items-start">
                            <img src="${m.chefImage}" class="w-16 h-16 rounded-full object-cover">
                            <div class="ml-4 flex-1">
                                <h3 class="font-bold text-lg text-gray-800">${m.title}</h3>
                                <p class="text-sm text-gray-500 mt-1">${m.chefName}</p>
                                <p class="text-xs text-gray-400 mt-2 line-clamp-2">${m.description}</p>
                                <div class="flex items-center justify-between mt-3">
                                    <div class="flex items-center space-x-3 text-xs text-gray-500">
                                        <span> ${m.duration}</span>
                                        <span> ${m.rating}</span>
                                    </div>
                                    <span class="font-bold text-red-600">${m.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewMasterclassDetail(masterclassId) {
            const masterclass = masterclasses.find(m => m.id === masterclassId);
            if (!masterclass) return;
            
            currentMasterclassId = masterclassId;
            
            document.getElementById('masterclass-chef-image').src = masterclass.chefImage;
            document.getElementById('masterclass-title').textContent = masterclass.title;
            document.getElementById('masterclass-chef-name').textContent = masterclass.chefName;
            document.getElementById('masterclass-rating').textContent = masterclass.rating;
            document.getElementById('masterclass-description').textContent = masterclass.description;
            document.getElementById('masterclass-duration').textContent = masterclass.duration;
            document.getElementById('masterclass-price').textContent = masterclass.price;
            document.getElementById('masterclass-total').textContent = masterclass.price;
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('masterclass-date').setAttribute('min', today);
            document.getElementById('masterclass-date').value = '';
            document.getElementById('masterclass-time').value = '';
            
            previousScreen = currentScreen;
            showScreen('masterclass-detail');
        }

        function bookMasterclass() {
            if (!currentMasterclassId) return;
            
            const masterclass = masterclasses.find(m => m.id === currentMasterclassId);
            if (!masterclass) return;
            
            const date = document.getElementById('masterclass-date').value;
            const time = document.getElementById('masterclass-time').value;
            
            if (!date || !time) {
                showCustomAlert('Please select both date and time', 'Required Information', 'error');
                return;
            }
            
            const bookingId = `MC-${Math.floor(Math.random() * 9000) + 1000}`;
            
            myBookings.unshift({
                id: bookingId,
                masterclassId: currentMasterclassId,
                title: masterclass.title,
                chefName: masterclass.chefName,
                chefImage: masterclass.chefImage,
                date: date,
                time: time,
                price: masterclass.price,
                duration: masterclass.duration,
                status: 'confirmed',
                bookedAt: new Date().toLocaleDateString(),
                trackingHistory: [
                    {
                        status: 'confirmed',
                        message: 'Masterclass booking confirmed',
                        timestamp: new Date().toISOString(),
                        time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
                    }
                ]
            });
            
            saveBookingsToStorage();
            showCustomAlert(`Masterclass booked successfully!\nBooking ID: ${bookingId}`, 'Booking Confirmed', 'success');
            setTimeout(() => {
                showScreen('my-bookings');
            }, 1500);
        }

        function renderMyBookings() {
            const list = document.getElementById('my-bookings-list');
            if (!list) return;
            
            if (myBookings.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <p class="text-gray-500 text-lg mb-2">No bookings yet</p>
                        <p class="text-gray-400 text-sm">Your masterclass bookings will appear here</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = myBookings.map(booking => {
                let statusColor = 'bg-green-100 text-green-700';
                if (booking.status === 'pending') statusColor = 'bg-yellow-100 text-yellow-700';
                if (booking.status === 'cancelled' || booking.status === 'rejected') statusColor = 'bg-red-100 text-red-700';
                
                return `
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex items-start mb-3">
                            <img src="${booking.chefImage}" class="w-12 h-12 rounded-full object-cover">
                            <div class="ml-3 flex-1">
                                <h3 class="font-bold text-lg">${booking.title}</h3>
                                <p class="text-sm text-gray-500">${booking.chefName}</p>
                            </div>
                            <span class="px-3 py-1 ${statusColor} rounded-full text-xs font-semibold">${booking.status}</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                ${new Date(booking.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </div>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                ${booking.time}  ${booking.duration}
                            </div>
                            ${booking.location ? `
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    ${booking.location}
                                </div>
                            ` : ''}
                            ${booking.guests ? `
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                    ${booking.guests} ${booking.guests === 1 ? 'guest' : 'guests'}
                                </div>
                            ` : ''}
                            ${booking.serviceType ? `
                                <div class="text-xs text-gray-500 capitalize">${booking.serviceType.replace('-', ' ')}</div>
                            ` : ''}
                        </div>
                        <div class="flex justify-between items-center pt-3 mt-3 border-t">
                            <span class="text-xs text-gray-500">Booking ID: ${booking.id}</span>
                            <span class="font-bold text-lg text-red-600">${booking.price}</span>
                        </div>
                        ${booking.status === 'confirmed' || booking.status === 'pending' ? `
                            <div class="flex gap-2 mt-3 pt-3 border-t">
                                <button onclick="startCall('${booking.chefName}', '${booking.chefImage}', 'video')" class="flex-1 px-3 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                    Video Call
                                </button>
                                <button onclick="startCall('${booking.chefName}', '${booking.chefImage}', 'audio')" class="flex-1 px-3 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                    Audio Call
                                </button>
                                <button onclick="cancelBooking('${booking.id}')" class="flex-1 px-3 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700 flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                    Cancel
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function bookChefDirect() {
            const chef = chefs.find(c => c.id === currentChefId);
            if (!chef) {
                // Try to get from chef profile
                const chefName = document.getElementById('chef-profile-name')?.textContent;
                if (chefName) {
                    const foundChef = chefs.find(c => c.name === chefName);
                    if (foundChef) {
                        currentChefId = foundChef.id;
                        setupBookChefScreen(foundChef);
                        return;
                    }
                }
                return;
            }
            setupBookChefScreen(chef);
        }

        function bookChefFromDish() {
            if (!currentChefId) {
                showCustomAlert('Chef information not available', 'Error', 'error');
                return;
            }
            const chef = chefs.find(c => c.id === currentChefId);
            if (chef) {
                const dish = dishes.all.find(d => d.id === currentDishId);
                previousScreen = 'dish-detail';
                setupBookChefScreen(chef, dish);
            } else {
                showCustomAlert('Chef not found', 'Error', 'error');
            }
        }

        function setupBookChefScreen(chef, dish = null) {
            document.getElementById('book-chef-image').src = chef.image;
            document.getElementById('book-chef-name').textContent = chef.name;
            document.getElementById('book-chef-specialty').textContent = chef.specialty;
            document.getElementById('book-chef-rating').textContent = chef.rating;
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('chef-booking-date').setAttribute('min', today);
            document.getElementById('chef-booking-date').value = '';
            document.getElementById('chef-booking-time').value = '';
            document.getElementById('chef-booking-duration').value = '3';
            document.getElementById('chef-booking-guests').value = '1';
            document.getElementById('chef-booking-location').value = '';
            document.getElementById('chef-service-type').value = 'catering';
            
            // Pre-fill notes with dish information if booking from dish page
            if (dish) {
                document.getElementById('chef-booking-notes').value = `Interested in booking for: ${dish.name}`;
            } else {
                document.getElementById('chef-booking-notes').value = '';
            }
            
            calculateChefBookingTotal();
            
            if (previousScreen !== 'dish-detail') {
                previousScreen = currentScreen;
            }
            showScreen('book-chef');
        }

        function calculateChefBookingTotal() {
            const duration = parseInt(document.getElementById('chef-booking-duration').value) || 3;
            const guests = parseInt(document.getElementById('chef-booking-guests').value) || 1;
            const serviceType = document.getElementById('chef-service-type').value;
            
            let basePrice = 50;
            if (serviceType === 'catering') basePrice = 50;
            else if (serviceType === 'private-dining') basePrice = 75;
            else if (serviceType === 'cooking-lesson') basePrice = 60;
            else if (serviceType === 'event') basePrice = 100;
            else basePrice = 50;
            
            const total = basePrice * duration + (guests * 10);
            document.getElementById('chef-booking-total').textContent = `JOD ${total}`;
        }

        function submitChefBooking() {
            if (!currentChefId) {
                showCustomAlert('Please select a chef', 'Required Information', 'error');
                return;
            }
            
            const chef = chefs.find(c => c.id === currentChefId);
            if (!chef) return;
            
            const date = document.getElementById('chef-booking-date').value;
            const time = document.getElementById('chef-booking-time').value;
            const duration = document.getElementById('chef-booking-duration').value;
            const guests = document.getElementById('chef-booking-guests').value;
            const location = document.getElementById('chef-booking-location').value.trim();
            const serviceType = document.getElementById('chef-service-type').value;
            const notes = document.getElementById('chef-booking-notes').value.trim();
            
            if (!date || !time || !location) {
                showCustomAlert('Please fill in all required fields', 'Required Information', 'error');
                return;
            }
            
            const bookingId = `CB-${Math.floor(Math.random() * 9000) + 1000}`;
            const total = parseInt(document.getElementById('chef-booking-total').textContent.replace('JOD ', ''));
            
            const booking = {
                id: bookingId,
                chefId: currentChefId,
                chefName: chef.name,
                chefImage: chef.image,
                serviceType: serviceType,
                date: date,
                time: time,
                duration: `${duration} hours`,
                guests: guests,
                location: location,
                notes: notes,
                price: `JOD ${total}`,
                status: 'pending',
                bookedAt: new Date().toLocaleDateString(),
                customerName: 'You'
            };
            
            allChefBookings.push(booking);
            myBookings.push({
                ...booking,
                title: `${serviceType.charAt(0).toUpperCase() + serviceType.slice(1).replace('-', ' ')} - ${chef.name}`,
                type: 'chef-booking',
                trackingHistory: [
                    {
                        status: 'pending',
                        message: 'Booking request submitted and awaiting chef confirmation',
                        timestamp: new Date().toISOString(),
                        time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
                    }
                ]
            });
            
            saveBookingsToStorage();
            showCustomAlert(`Booking request submitted!\nBooking ID: ${bookingId}\n\nThe chef will review and confirm your booking.`, 'Booking Submitted', 'success');
            setTimeout(() => {
                showScreen('my-bookings');
            }, 2000);
        }

        function showChefTab(tab) {
            currentChefTab = tab;
            
            // Reset all tabs
            ['orders', 'bookings', 'menu', 'analytics'].forEach(t => {
                const tabBtn = document.getElementById(`chef-tab-${t}`);
                const container = document.getElementById(`${t === 'orders' ? 'orders' : t === 'bookings' ? 'bookings' : t === 'menu' ? 'menu' : 'analytics'}-container`);
                if (tabBtn) {
                    tabBtn.classList.remove('border-red-600', 'text-red-600');
                    tabBtn.classList.add('border-transparent', 'text-gray-500');
                }
                if (container) {
                    container.classList.add('hidden');
                }
            });
            
            // Activate selected tab
            const activeTabBtn = document.getElementById(`chef-tab-${tab}`);
            const activeContainer = document.getElementById(`${tab === 'orders' ? 'orders' : tab === 'bookings' ? 'bookings' : tab === 'menu' ? 'menu' : 'analytics'}-container`);
            
            if (activeTabBtn) {
                activeTabBtn.classList.remove('border-transparent', 'text-gray-500');
                activeTabBtn.classList.add('border-red-600', 'text-red-600');
            }
            if (activeContainer) {
                activeContainer.classList.remove('hidden');
            }
            
            // Render content based on tab
            if (tab === 'orders') {
                renderOrders();
            } else if (tab === 'bookings') {
                renderChefBookings();
            } else if (tab === 'menu') {
                renderChefMenu();
            } else if (tab === 'analytics') {
                renderAnalytics();
            }
        }

        function renderChefBookings() {
            const container = document.getElementById('bookings-container');
            if (!container) return;
            
            // Get current logged in chef ID from localStorage
            const loggedInUsername = localStorage.getItem('username');
            if (!loggedInUsername) {
                container.innerHTML = '<div class="text-center py-12"><p class="text-gray-500">Please log in</p></div>';
                return;
            }
            
            // Find the chef by username (username matches chef id)
            const loggedInChef = chefs.find(c => c.id === loggedInUsername);
            if (!loggedInChef) {
                container.innerHTML = '<div class="text-center py-12"><p class="text-gray-500">Chef not found</p></div>';
                return;
            }
            
            const loggedInChefId = loggedInChef.id;
            const chefBookings = allChefBookings.filter(b => b.chefId === loggedInChefId);
            
            if (chefBookings.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <p class="text-gray-500 text-lg mb-2">No bookings yet</p>
                        <p class="text-gray-400 text-sm">Customer bookings will appear here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = chefBookings.map(booking => {
                let statusColor = 'bg-yellow-100 text-yellow-700';
                if (booking.status === 'confirmed') statusColor = 'bg-green-100 text-green-700';
                if (booking.status === 'rejected') statusColor = 'bg-red-100 text-red-700';
                if (booking.status === 'cancelled') statusColor = 'bg-gray-100 text-gray-700';
                
                return `
                    <div class="bg-white rounded-lg shadow p-4 mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg">${booking.id}</h3>
                                <p class="text-sm text-gray-500 mt-1">${booking.customerName || 'Customer'}</p>
                                <p class="text-sm text-gray-700 mt-2 font-medium capitalize">${booking.serviceType.replace('-', ' ')}</p>
                            </div>
                            <span class="px-3 py-1 ${statusColor} rounded-full text-xs font-semibold whitespace-nowrap">${booking.status}</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600 mb-3">
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                ${new Date(booking.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </div>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                ${booking.time}  ${booking.duration}
                            </div>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                ${booking.location}
                            </div>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                                </svg>
                                ${booking.guests} ${booking.guests === 1 ? 'guest' : 'guests'}
                            </div>
                            ${booking.notes ? `<div class="text-xs text-gray-500 mt-2 italic">"${booking.notes}"</div>` : ''}
                        </div>
                        <div class="flex justify-between items-center mb-3 pb-3 border-b">
                            <div class="text-sm text-gray-500">
                                <div>Booked: ${booking.bookedAt}</div>
                            </div>
                            <span class="font-bold text-lg text-red-600">${booking.price}</span>
                        </div>
                        ${booking.status === 'pending' ? `
                            <div class="flex gap-2">
                                <button onclick="updateChefBookingStatus('${booking.id}', 'confirmed')" class="flex-1 px-3 py-2 text-sm font-semibold rounded-lg bg-green-500 text-white hover:bg-green-600 transition">
                                    Confirm
                                </button>
                                <button onclick="updateChefBookingStatus('${booking.id}', 'rejected')" class="flex-1 px-3 py-2 text-sm font-semibold rounded-lg bg-red-500 text-white hover:bg-red-600 transition">
                                    Reject
                                </button>
                            </div>
                        ` : ''}
                        ${booking.status === 'confirmed' ? `
                            <div class="flex gap-2 mt-3 pt-3 border-t">
                                <button onclick="startCall('${booking.customerName}', '', 'video')" class="flex-1 px-3 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                    Video Call
                                </button>
                                <button onclick="startCall('${booking.customerName}', '', 'audio')" class="flex-1 px-3 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                    Audio Call
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateChefBookingStatus(bookingId, newStatus) {
            const booking = allChefBookings.find(b => b.id === bookingId);
            if (booking) {
                booking.status = newStatus;
                
                // Update in myBookings too
                const myBooking = myBookings.find(b => b.id === bookingId);
                if (myBooking) {
                    myBooking.status = newStatus;
                    
                    // Add tracking history for masterclass bookings
                    if (!myBooking.trackingHistory) {
                        myBooking.trackingHistory = [];
                    }
                    
                    // Check if this status already has a history entry
                    const existingEntry = myBooking.trackingHistory.find(h => h.status === newStatus);
                    if (!existingEntry) {
                        myBooking.trackingHistory.push({
                            status: newStatus,
                            message: getBookingStatusMessage(newStatus),
                            timestamp: new Date().toISOString(),
                            time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
                        });
                    } else {
                        // Update existing entry with new timestamp
                        existingEntry.timestamp = new Date().toISOString();
                        existingEntry.time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        existingEntry.message = getBookingStatusMessage(newStatus);
                    }
                }
                
                renderChefBookings();
                saveBookingsToStorage();
                
                // Re-render customer bookings if they're viewing it
                if (currentScreen === 'my-bookings') {
                    renderMyBookings();
                }
                
                showCustomAlert(`Booking ${newStatus === 'confirmed' ? 'confirmed' : 'rejected'}!`, 'Status Updated', newStatus === 'confirmed' ? 'success' : 'error');
            }
        }
        
        function getBookingStatusMessage(status) {
            const messages = {
                'pending': 'Your booking request is pending chef confirmation',
                'confirmed': 'Your booking has been confirmed by the chef',
                'rejected': 'Your booking request has been rejected',
                'cancelled': 'Your booking has been cancelled'
            };
            return messages[status] || 'Booking status updated';
        }

        function viewDish(dishId) {
            const dish = dishes.all.find(d => d.id === dishId);
            if (!dish) return;
            
            currentDishId = dishId;
            currentChefId = dish.chefId;
            
            const chef = chefs.find(c => c.id === dish.chefId);
            
            const detailScreen = document.getElementById('dish-detail');
            if (!detailScreen) return;
            
            const dishImage = detailScreen.querySelector('img');
            if (dishImage) dishImage.src = dish.image;
            
            const dishNameEl = document.getElementById('dish-detail-name');
            if (dishNameEl) dishNameEl.textContent = dish.name;
            
            const dishDescEl = document.getElementById('dish-detail-description');
            if (dishDescEl) dishDescEl.textContent = `Delicious ${dish.name.toLowerCase()} from ${dish.chef}.`;
            
            const dishPriceEl = document.getElementById('dish-detail-price');
            if (dishPriceEl) dishPriceEl.textContent = dish.price;
            
            if (chef) {
                const chefImageEl = document.getElementById('dish-chef-image');
                if (chefImageEl) chefImageEl.src = chef.image;
                
                const chefNameEl = document.getElementById('dish-chef-name');
                if (chefNameEl) chefNameEl.textContent = chef.name;
                
                const chefSpecialtyEl = document.getElementById('dish-chef-specialty');
                if (chefSpecialtyEl) chefSpecialtyEl.textContent = chef.specialty;
            }
            
            // Populate ingredient options based on dish (use dish-specific if available, otherwise category defaults)
            populateIngredientOptions(dish.category, dish);
            
            // Clear customization fields
            const allergiesEl = document.getElementById('dish-allergies');
            if (allergiesEl) allergiesEl.value = '';
            
            const specialInstructionsEl = document.getElementById('dish-special-instructions');
            if (specialInstructionsEl) specialInstructionsEl.value = '';
            
            // Add event listeners to update price when ingredients are selected
            setTimeout(() => {
                document.querySelectorAll('.extra-ingredient').forEach(checkbox => {
                    checkbox.addEventListener('change', () => updateDishPrice(dish));
                });
                updateDishPrice(dish);
            }, 100);
            
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            if (addToCartBtn) {
                addToCartBtn.textContent = `Add to Cart - ${dish.price}`;
                addToCartBtn.onclick = function() {
                    addToCart(dishId);
                };
            }
            
            showScreen('dish-detail');
        }

        function updateDishPrice(dish) {
            const selectedExtraIngredients = Array.from(document.querySelectorAll('.extra-ingredient:checked'));
            let totalExtraCharges = 0;
            
            selectedExtraIngredients.forEach(checkbox => {
                // Random price between 0.5 and 1 JOD (store it in data attribute for consistency)
                if (!checkbox.dataset.price) {
                    const price = (Math.random() * 0.5 + 0.5).toFixed(2);
                    checkbox.dataset.price = price;
                }
                totalExtraCharges += parseFloat(checkbox.dataset.price);
            });
            
            const basePrice = parseFloat(dish.price.replace('JOD ', ''));
            const totalPrice = basePrice + totalExtraCharges;
            
            const priceDisplay = document.getElementById('dish-detail-price');
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            
            if (totalExtraCharges > 0) {
                if (priceDisplay) {
                    priceDisplay.innerHTML = `
                        <div class="text-2xl font-bold text-red-600">JOD ${totalPrice.toFixed(2)}</div>
                        <div class="text-xs text-gray-500 mt-1">Base: ${dish.price} + Extra: ${totalExtraCharges.toFixed(2)} JOD</div>
                    `;
                }
                if (addToCartBtn) addToCartBtn.textContent = `Add to Cart - JOD ${totalPrice.toFixed(2)}`;
            } else {
                if (priceDisplay) priceDisplay.textContent = dish.price;
                if (addToCartBtn) addToCartBtn.textContent = `Add to Cart - ${dish.price}`;
            }
        }

        function populateIngredientOptions(category, dish = null) {
            // Use dish-specific ingredients if available, otherwise fall back to category defaults
            let ingredients;
            if (dish && dish.customIngredients && (dish.customIngredients.add.length > 0 || dish.customIngredients.remove.length > 0)) {
                ingredients = dish.customIngredients;
            } else {
                ingredients = ingredientsData[category] || {
                    add: ['Extra Sauce', 'Extra Vegetables', 'Extra Meat'],
                    remove: ['Onions', 'Garlic', 'Spices']
                };
            }
            
            // Normalize ingredients to objects
            const normalizeIng = (ing) => {
                if (typeof ing === 'string') {
                    return { name: ing, price: 0.50 };
                }
                return ing;
            };
            
            // Populate add ingredients with prices
            const addList = document.getElementById('extra-ingredients-list');
            const addIngredients = (ingredients.add || []).map(normalizeIng);
            addList.innerHTML = addIngredients.map(ing => {
                const price = ing.price || 0.50;
                const ingName = typeof ing === 'string' ? ing : ing.name;
                return `
                <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                    <div class="flex items-center flex-1">
                        <input type="checkbox" value="${ingName}" data-price="${price.toFixed(2)}" class="extra-ingredient mr-2 rounded border-gray-300 text-red-600 focus:ring-red-500">
                        <span class="text-sm text-gray-700">${ingName}</span>
                    </div>
                    <span class="text-sm font-semibold text-red-600 ml-2">+${price.toFixed(2)} JOD</span>
                </label>
            `;
            }).join('');
            
            // Populate remove ingredients (free - no charge)
            const removeList = document.getElementById('remove-ingredients-list');
            const removeIngredients = (ingredients.remove || []).map(normalizeIng);
            removeList.innerHTML = removeIngredients.map(ing => {
                const ingName = typeof ing === 'string' ? ing : ing.name;
                return `
                <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                    <div class="flex items-center flex-1">
                        <input type="checkbox" value="${ingName}" class="remove-ingredient mr-2 rounded border-gray-300 text-red-600 focus:ring-red-500">
                        <span class="text-sm text-gray-700">${ingName}</span>
                    </div>
                    <span class="text-xs text-gray-500 ml-2">Free</span>
                </label>
            `;
            }).join('');
        }

        function addToCart(dishId) {
            const dish = dishes.all.find(d => d.id === dishId);
            if (!dish) return;
            
            // Collect customizations
            const extraIngredients = Array.from(document.querySelectorAll('.extra-ingredient:checked')).map(cb => cb.value);
            const removeIngredients = Array.from(document.querySelectorAll('.remove-ingredient:checked')).map(cb => cb.value);
            const allergies = document.getElementById('dish-allergies').value.trim();
            const specialInstructions = document.getElementById('dish-special-instructions').value.trim();
            
            // Calculate charges for extra ingredients (0.5 to 1 JOD each, randomized)
            const extraIngredientPrices = {};
            let totalExtraCharges = 0;
            extraIngredients.forEach(ingredient => {
                // Get price from checkbox data attribute if available, otherwise generate random
                const checkbox = Array.from(document.querySelectorAll('.extra-ingredient')).find(cb => cb.value === ingredient);
                let price;
                if (checkbox && checkbox.dataset.price) {
                    price = parseFloat(checkbox.dataset.price);
                } else {
                    price = parseFloat((Math.random() * 0.5 + 0.5).toFixed(2));
                }
                extraIngredientPrices[ingredient] = price;
                totalExtraCharges += price;
            });
            
            const customizations = {
                extraIngredients: extraIngredients,
                removeIngredients: removeIngredients,
                allergies: allergies,
                specialInstructions: specialInstructions,
                extraIngredientPrices: extraIngredientPrices,
                totalExtraCharges: totalExtraCharges
            };
            
            const existingItem = cart.find(item => item.id === dishId && JSON.stringify(item.customizations) === JSON.stringify(customizations));
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    ...dish, 
                    quantity: 1,
                    customizations: customizations
                });
            }
            
            updateCart();
            showScreen('cart');
        }

        function updateCart() {
            // Update cart count badge
            const cartBadge = document.getElementById('cart-count-badge');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (cartBadge) {
                if (totalItems > 0) {
                    cartBadge.textContent = totalItems > 99 ? '99+' : totalItems;
                    cartBadge.classList.remove('hidden');
                } else {
                    cartBadge.classList.add('hidden');
                }
            }
            
            const cartScreen = document.getElementById('cart');
            if (!cartScreen) return;
            
            const itemsContainer = document.getElementById('cart-items-container');
            if (!itemsContainer) return;
            
            if (cart.length === 0) {
                itemsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Your cart is empty</p>';
                const summary = cartScreen.querySelector('.bg-white.rounded-lg.shadow.p-4:last-of-type');
                if (summary) {
                    summary.innerHTML = `
                        <div class="flex justify-between mb-2">
                            <span>Subtotal</span>
                            <span>JOD 0.00</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Delivery</span>
                            <span>JOD 0.00</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg pt-2 border-t">
                            <span>Total</span>
                            <span class="text-red-600">JOD 0.00</span>
                        </div>
                    `;
                }
                const placeOrderBtn = cartScreen.querySelector('.btn-primary');
                if (placeOrderBtn) {
                    placeOrderBtn.textContent = 'Cart is Empty';
                    placeOrderBtn.disabled = true;
                }
                return;
            }
            
            itemsContainer.innerHTML = `
                <h3 class="font-semibold mb-3">Order Items</h3>
                ${cart.map(item => {
                    const customizations = item.customizations || {};
                    let customizationsHtml = '';
                    const basePrice = parseFloat(item.price.replace('JOD ', ''));
                    const extraCharges = customizations.totalExtraCharges || 0;
                    const itemTotalPrice = (basePrice + extraCharges) * item.quantity;
                    
                    if (customizations.extraIngredients && customizations.extraIngredients.length > 0) {
                        const extraList = customizations.extraIngredients.map(ing => {
                            const price = customizations.extraIngredientPrices && customizations.extraIngredientPrices[ing] 
                                ? customizations.extraIngredientPrices[ing].toFixed(2) 
                                : '0.50';
                            return `${ing} (+${price} JOD)`;
                        }).join(', ');
                        customizationsHtml += `<div class="text-xs mt-1 text-green-600">+ Add: ${extraList}</div>`;
                    }
                    if (customizations.removeIngredients && customizations.removeIngredients.length > 0) {
                        customizationsHtml += `<div class="text-xs mt-1 text-red-600">- Remove: ${customizations.removeIngredients.join(', ')}</div>`;
                    }
                    if (customizations.allergies) {
                        customizationsHtml += `<div class="text-xs mt-1 text-orange-600"> Allergies: ${customizations.allergies}</div>`;
                    }
                    if (customizations.specialInstructions) {
                        customizationsHtml += `<div class="text-xs mt-1 text-blue-600"> Notes: ${customizations.specialInstructions}</div>`;
                    }
                    
                    return `
                    <div class="mb-3 pb-3 border-b">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <h4 class="font-semibold">${item.name}</h4>
                                <p class="text-sm text-gray-500">${item.chef}</p>
                                ${customizationsHtml}
                                <div class="flex items-center mt-2">
                                    <button onclick="updateQuantity(${item.id}, -1)" class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100">-</button>
                                    <span class="mx-3 font-semibold">${item.quantity}</span>
                                    <button onclick="updateQuantity(${item.id}, 1)" class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100">+</button>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="font-bold">JOD ${itemTotalPrice.toFixed(2)}</span>
                                ${extraCharges > 0 ? `<div class="text-xs text-gray-500">Base: ${item.price} + ${extraCharges.toFixed(2)} JOD</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                }).join('')}
            `;
            
            const subtotal = cart.reduce((sum, item) => {
                const basePrice = parseFloat(item.price.replace('JOD ', ''));
                const extraCharges = (item.customizations && item.customizations.totalExtraCharges) || 0;
                return sum + ((basePrice + extraCharges) * item.quantity);
            }, 0);
            const delivery = 2.50;
            const total = subtotal + delivery;
            
            const summary = cartScreen.querySelector('.bg-white.rounded-lg.shadow.p-4:last-of-type');
            if (summary) {
                summary.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <span>Subtotal</span>
                        <span>JOD ${subtotal.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span>Delivery</span>
                        <span>JOD ${delivery.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg pt-2 border-t">
                        <span>Total</span>
                        <span class="text-red-600">JOD ${total.toFixed(2)}</span>
                    </div>
                `;
            }
            
            const placeOrderBtn = cartScreen.querySelector('.btn-primary');
            if (placeOrderBtn) {
                placeOrderBtn.textContent = `Edit Order - JOD ${total.toFixed(2)}`;
                placeOrderBtn.disabled = false;
            }
        }

        function updateQuantity(dishId, change) {
            const item = cart.find(i => i.id === dishId);
            if (!item) return;
            
            item.quantity += change;
            if (item.quantity <= 0) {
                cart = cart.filter(i => i.id !== dishId);
            }
            
            updateCart();
            updateEditOrder();
        }

        function updateEditOrder() {
            const editScreen = document.getElementById('edit-order');
            if (!editScreen) return;
            
            const itemsList = document.getElementById('order-items-list');
            if (!itemsList) return;
            
            itemsList.innerHTML = cart.map(item => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div class="flex-1">
                        <h4 class="font-semibold">${item.name}</h4>
                        <p class="text-sm text-gray-500">${item.chef}</p>
                    </div>
                    <div class="flex items-center mx-4">
                        <button onclick="updateQuantity(${item.id}, -1); updateEditOrder();" class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center">-</button>
                        <span class="mx-3 font-semibold">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1); updateEditOrder();" class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center">+</button>
                    </div>
                    <div class="text-right">
                        <span class="font-bold">${item.price}</span>
                    </div>
                </div>
            `).join('');
            
            const subtotal = cart.reduce((sum, item) => {
                const basePrice = parseFloat(item.price.replace('JOD ', ''));
                const extraCharges = (item.customizations && item.customizations.totalExtraCharges) || 0;
                return sum + ((basePrice + extraCharges) * item.quantity);
            }, 0);
            const delivery = 2.50;
            const total = subtotal + delivery;
            
            const editSubtotalEl = document.getElementById('edit-subtotal');
            if (editSubtotalEl) editSubtotalEl.textContent = `JOD ${subtotal.toFixed(2)}`;
            
            const editTotalEl = document.getElementById('edit-total');
            if (editTotalEl) editTotalEl.textContent = `JOD ${total.toFixed(2)}`;
            
            const placeOrderTotalEl = document.getElementById('place-order-total');
            if (placeOrderTotalEl) placeOrderTotalEl.textContent = `JOD ${total.toFixed(2)}`;
        }

        function selectPayment(method, eventElement) {
            selectedPaymentMethod = method;
            const cashRadio = document.getElementById('payment-cash');
            if (cashRadio) cashRadio.checked = method === 'cash';
            
            const visaRadio = document.getElementById('payment-visa');
            if (visaRadio) visaRadio.checked = method === 'visa';
            
            document.querySelectorAll('.payment-option').forEach(label => {
                label.classList.remove('border-red-500');
                label.classList.add('border-gray-200');
            });
            
            // Highlight the selected option
            if (eventElement) {
                eventElement.classList.remove('border-gray-200');
                eventElement.classList.add('border-red-500');
            } else {
                // Fallback: find and highlight the selected option
                const selectedOption = method === 'cash' 
                    ? document.querySelector('#payment-cash')?.closest('label')
                    : document.querySelector('#payment-visa')?.closest('label');
                if (selectedOption) {
                    selectedOption.classList.remove('border-gray-200');
                    selectedOption.classList.add('border-red-500');
                }
            }
            
            // Show/hide Visa payment form
            const visaForm = document.getElementById('visa-payment-form');
            if (visaForm) {
                if (method === 'visa') {
                    visaForm.classList.remove('hidden');
                    loadSavedCards(); // Load saved cards when Visa is selected
                } else {
                    visaForm.classList.add('hidden');
                }
            }
        }

        function formatCardNumber(input) {
            let value = input.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            if (formattedValue.length > 19) formattedValue = formattedValue.substr(0, 19);
            input.value = formattedValue;
        }

        function formatExpiryDate(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            input.value = value;
        }

        function placeOrder() {
            if (cart.length === 0) {
                showCustomAlert('Your cart is empty!', 'Empty Cart', 'error');
                return;
            }
            
            const location = document.getElementById('delivery-location').value.trim();
            if (!location) {
                showCustomAlert('Please enter your delivery address', 'Required Information', 'error');
                return;
            }
            
            if (!selectedPaymentMethod) {
                showCustomAlert('Please select a payment method', 'Required Information', 'error');
                return;
            }
            
            // Validate Visa payment information if Visa is selected
            if (selectedPaymentMethod === 'visa') {
                const cardName = document.getElementById('visa-card-name').value.trim();
                const cardNumber = document.getElementById('visa-card-number').value.trim().replace(/\s/g, '');
                const cardExpiry = document.getElementById('visa-card-expiry').value.trim();
                const cardCvv = document.getElementById('visa-card-cvv').value.trim();
                
                if (!cardName || !cardNumber || !cardExpiry || !cardCvv) {
                    showCustomAlert('Please fill in all Visa card information', 'Required Information', 'error');
                    return;
                }
                
                if (cardNumber.length < 13 || cardNumber.length > 19) {
                    showCustomAlert('Please enter a valid card number', 'Invalid Card', 'error');
                    return;
                }
                
                if (cardExpiry.length !== 5 || !cardExpiry.match(/^\d{2}\/\d{2}$/)) {
                    showCustomAlert('Please enter a valid expiry date (MM/YY)', 'Invalid Date', 'error');
                    return;
                }
                
                if (cardCvv.length < 3 || cardCvv.length > 4) {
                    showCustomAlert('Please enter a valid CVV', 'Invalid CVV', 'error');
                    return;
                }
            }
            
            const subtotal = cart.reduce((sum, item) => {
                const basePrice = parseFloat(item.price.replace('JOD ', ''));
                const extraCharges = (item.customizations && item.customizations.totalExtraCharges) || 0;
                return sum + ((basePrice + extraCharges) * item.quantity);
            }, 0);
            const delivery = 2.50;
            const total = subtotal + delivery;
            
            const orderId = `DH-${Math.floor(Math.random() * 9000) + 1000}`;
            const trackingNumber = `TRK${Math.floor(Math.random() * 900000) + 100000}`;
            const orderItems = cart.map(item => `${item.name} x${item.quantity}`).join(', ');
            
            // Collect Visa payment information if Visa is selected
            let visaInfo = null;
            if (selectedPaymentMethod === 'visa') {
                const cardName = document.getElementById('visa-card-name').value.trim();
                const cardNumber = document.getElementById('visa-card-number').value.trim().replace(/\s/g, '');
                const cardExpiry = document.getElementById('visa-card-expiry').value.trim();
                const cardCvv = document.getElementById('visa-card-cvv').value.trim();
                const billingAddress = document.getElementById('visa-billing-address').value.trim() || location;
                const billingCity = document.getElementById('visa-billing-city').value.trim() || 'Amman';
                const billingZip = document.getElementById('visa-billing-zip').value.trim() || '11118';
                
                visaInfo = {
                    cardName: cardName,
                    cardNumber: cardNumber,
                    cardExpiry: cardExpiry,
                    cardCvv: cardCvv,
                    billingAddress: billingAddress,
                    billingCity: billingCity,
                    billingZip: billingZip
                };
                // Mask card number for display (show only last 4 digits)
                visaInfo.maskedCardNumber = '**** **** **** ' + visaInfo.cardNumber.slice(-4);
                
                // Save card if checkbox is checked
                const saveCardCheckbox = document.getElementById('save-card-checkbox');
                if (saveCardCheckbox && saveCardCheckbox.checked) {
                    // Check if card already exists
                    const existingCardIndex = savedCards.findIndex(c => 
                        c.cardNumber === cardNumber && c.cardExpiry === cardExpiry
                    );
                    
                    if (existingCardIndex === -1) {
                        // Add new card
                        savedCards.push({
                            cardName: cardName,
                            cardNumber: cardNumber,
                            cardExpiry: cardExpiry,
                            cardCvv: cardCvv,
                            billingAddress: billingAddress,
                            billingCity: billingCity,
                            billingZip: billingZip,
                            maskedCardNumber: visaInfo.maskedCardNumber,
                            savedAt: new Date().toISOString()
                        });
                        saveCardsToStorage();
                        renderSavedCards();
                        showCustomAlert('Card saved successfully!', 'Card Saved', 'success');
                    } else {
                        // Update existing card
                        savedCards[existingCardIndex] = {
                            cardName: cardName,
                            cardNumber: cardNumber,
                            cardExpiry: cardExpiry,
                            cardCvv: cardCvv,
                            billingAddress: billingAddress,
                            billingCity: billingCity,
                            billingZip: billingZip,
                            maskedCardNumber: visaInfo.maskedCardNumber,
                            savedAt: savedCards[existingCardIndex].savedAt || new Date().toISOString()
                        };
                        saveCardsToStorage();
                        renderSavedCards();
                    }
                }
            }
            
            // Create order items with customizations for chef portal
            const orderItemsWithCustomizations = cart.map(item => {
                let itemText = `${item.name} x${item.quantity}`;
                const customizations = item.customizations || {};
                
                if (customizations.extraIngredients && customizations.extraIngredients.length > 0) {
                    const extraList = customizations.extraIngredients.map(ing => {
                        const price = customizations.extraIngredientPrices && customizations.extraIngredientPrices[ing] 
                            ? customizations.extraIngredientPrices[ing].toFixed(2) 
                            : '0.50';
                        return `${ing} (+${price} JOD)`;
                    }).join(', ');
                    itemText += ` [Add: ${extraList}]`;
                }
                if (customizations.removeIngredients && customizations.removeIngredients.length > 0) {
                    itemText += ` [Remove: ${customizations.removeIngredients.join(', ')}]`;
                }
                if (customizations.allergies) {
                    itemText += ` [Allergies: ${customizations.allergies}]`;
                }
                if (customizations.specialInstructions) {
                    itemText += ` [Notes: ${customizations.specialInstructions}]`;
                }
                
                return {
                    name: item.name,
                    quantity: item.quantity,
                    customizations: customizations
                };
            });
            
            // Add to orders array (for chef portal)
            orders.unshift({
                id: orderId,
                customer: 'You',
                dish: orderItems,
                total: `JOD ${total.toFixed(2)}`,
                status: 'pending',
                time: 'Just now',
                date: new Date().toLocaleDateString(),
                location: location,
                payment: selectedPaymentMethod === 'cash' ? 'Cash' : 'Visa',
                items: orderItemsWithCustomizations
            });
            
            // Add to my orders
            myOrders.unshift({
                id: orderId,
                trackingNumber: trackingNumber,
                items: orderItems,
                total: `JOD ${total.toFixed(2)}`,
                status: 'pending',
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
                location: location,
                payment: selectedPaymentMethod === 'cash' ? 'Cash on Delivery' : 'Visa Card',
                itemsWithCustomizations: orderItemsWithCustomizations,
                visaInfo: visaInfo,
                trackingHistory: [
                    {
                        status: 'pending',
                        message: 'Order placed and confirmed',
                        timestamp: new Date().toISOString(),
                        time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
                    }
                ],
                estimatedDelivery: new Date(Date.now() + 45 * 60 * 1000).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
            });
            
            // Clear Visa form if used
            if (selectedPaymentMethod === 'visa') {
                document.getElementById('visa-card-name').value = '';
                document.getElementById('visa-card-number').value = '';
                document.getElementById('visa-card-expiry').value = '';
                document.getElementById('visa-card-cvv').value = '';
                document.getElementById('visa-billing-address').value = '';
                document.getElementById('visa-billing-city').value = '';
                document.getElementById('visa-billing-zip').value = '';
                const visaForm = document.getElementById('visa-payment-form');
                if (visaForm) visaForm.classList.add('hidden');
            }
            
            saveBookingsToStorage();
            
            // Store the order ID for tracking
            lastOrderId = orderId;
            
            const confirmation = document.getElementById('order-confirmation');
            if (confirmation) {
                const orderNumberEl = confirmation.querySelector('.text-2xl.font-bold');
                if (orderNumberEl) orderNumberEl.textContent = `#${orderId}`;
                
                const totalEl = confirmation.querySelector('.font-semibold:last-of-type');
                if (totalEl) totalEl.textContent = `JOD ${total.toFixed(2)} (${selectedPaymentMethod === 'cash' ? 'Cash on Delivery' : 'Visa Card'})`;
            }
            
            cart = [];
            selectedPaymentMethod = 'cash';
            const cashRadio = document.getElementById('payment-cash');
            if (cashRadio) cashRadio.checked = true;
            const visaRadio = document.getElementById('payment-visa');
            if (visaRadio) visaRadio.checked = false;
            const deliveryLocation = document.getElementById('delivery-location');
            if (deliveryLocation) deliveryLocation.value = '';
            showScreen('order-confirmation');
        }

        function renderMyOrders() {
            const ordersList = document.getElementById('my-orders-list');
            if (!ordersList) return;
            
            if (myOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p class="text-gray-500 text-lg mb-2">No orders yet</p>
                        <p class="text-gray-400 text-sm">Your orders will appear here</p>
                    </div>
                `;
                return;
            }
            
            ordersList.innerHTML = myOrders.map(order => {
                let statusColor = 'bg-blue-100 text-blue-700';
                if (order.status === 'preparing') statusColor = 'bg-yellow-100 text-yellow-700';
                if (order.status === 'delivered') statusColor = 'bg-green-100 text-green-700';
                if (order.status === 'cancelled') statusColor = 'bg-red-100 text-red-700';
                
                return `
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-bold text-lg">#${order.id}</h3>
                                <p class="text-sm text-gray-500 mt-1">${order.items}</p>
                                <p class="text-xs text-gray-400 mt-2">
                                    <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    ${order.location}
                                </p>
                            </div>
                            <span class="px-3 py-1 ${statusColor} rounded-full text-xs font-semibold">${order.status}</span>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t">
                            <div class="text-sm text-gray-500">
                                <div>${order.date}  ${order.time}</div>
                                <div class="mt-1">Payment: ${order.payment}</div>
                            </div>
                            <span class="font-bold text-lg text-red-600">${order.total}</span>
                        </div>
                        ${order.status !== 'done' && order.status !== 'canceled' ? `
                            <div class="flex gap-2 mt-3 pt-3 border-t">
                                <button onclick="cancelOrder('${order.id}')" class="flex-1 px-3 py-2 bg-red-500 text-white text-sm font-semibold rounded-lg hover:bg-red-600">Cancel Order</button>
                            </div>
                        ` : ''}
                        ${order.status === 'done' ? `
                            <div class="flex gap-2 mt-3 pt-3 border-t">
                                <button onclick="reorder('${order.id}')" class="flex-1 px-3 py-2 bg-green-500 text-white text-sm font-semibold rounded-lg hover:bg-green-600">Reorder</button>
                            </div>
                        ` : ''}
                        <div class="flex gap-2 mt-3 pt-3 border-t">
                            <button onclick="trackOrder('${order.id}')" class="flex-1 px-3 py-2 bg-blue-500 text-white text-sm font-semibold rounded-lg hover:bg-blue-600 flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Track Order
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function trackOrder(orderId) {
            const order = myOrders.find(o => o.id === orderId);
            if (!order) {
                showCustomAlert('Order not found', 'Error', 'error');
                return;
            }
            
            currentTrackingOrderId = orderId;
            renderTrackOrder(order);
            showScreen('track-order');
        }

        let currentTrackingOrderId = null;

        function renderTrackOrder(order) {
            const container = document.getElementById('track-order-content');
            if (!container) return;
            
            // Get tracking history or create default
            const trackingHistory = order.trackingHistory || [
                {
                    status: order.status,
                    message: getStatusMessage(order.status),
                    timestamp: new Date().toISOString(),
                    time: order.time
                }
            ];
            
            // Status timeline
            const statuses = ['pending', 'preparing', 'on-the-way', 'delivered'];
            const currentStatusIndex = statuses.indexOf(order.status);
            
            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Order #${order.id}</h2>
                            <p class="text-sm text-gray-500 mt-1">Tracking: ${order.trackingNumber || 'N/A'}</p>
                        </div>
                        <span class="px-4 py-2 ${getStatusColor(order.status)} rounded-full text-sm font-semibold">${order.status}</span>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">Order Total</span>
                            <span class="text-xl font-bold text-red-600">${order.total}</span>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">Payment Method</span>
                            <span class="text-sm font-medium text-gray-800">${order.payment}</span>
                        </div>
                        ${order.visaInfo ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <p class="text-xs text-gray-500 mb-2">Payment Details:</p>
                                <div class="bg-blue-50 rounded-lg p-3 space-y-1">
                                    <div class="flex justify-between text-xs">
                                        <span class="text-gray-600">Cardholder:</span>
                                        <span class="font-medium">${order.visaInfo.cardName}</span>
                                    </div>
                                    <div class="flex justify-between text-xs">
                                        <span class="text-gray-600">Card Number:</span>
                                        <span class="font-medium">${order.visaInfo.maskedCardNumber || '**** **** **** ' + order.visaInfo.cardNumber.slice(-4)}</span>
                                    </div>
                                    <div class="flex justify-between text-xs">
                                        <span class="text-gray-600">Expiry:</span>
                                        <span class="font-medium">${order.visaInfo.cardExpiry}</span>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                    <h3 class="font-bold text-lg text-gray-800 mb-4">Order Items</h3>
                    <div class="space-y-3">
                        ${order.itemsWithCustomizations ? order.itemsWithCustomizations.map(item => `
                            <div class="border border-gray-200 rounded-lg p-3">
                                <div class="font-semibold text-gray-800">${item.name} x${item.quantity}</div>
                                ${item.customizations ? `
                                    <div class="mt-2 space-y-1 text-xs">
                                        ${item.customizations.extraIngredients && item.customizations.extraIngredients.length > 0 ? `
                                            <div class="text-green-600">+ Add: ${item.customizations.extraIngredients.join(', ')}</div>
                                        ` : ''}
                                        ${item.customizations.removeIngredients && item.customizations.removeIngredients.length > 0 ? `
                                            <div class="text-red-600">- Remove: ${item.customizations.removeIngredients.join(', ')}</div>
                                        ` : ''}
                                        ${item.customizations.allergies ? `
                                            <div class="text-orange-600"> Allergies: ${item.customizations.allergies}</div>
                                        ` : ''}
                                        ${item.customizations.specialInstructions ? `
                                            <div class="text-blue-600"> Notes: ${item.customizations.specialInstructions}</div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('') : `
                            <div class="text-gray-600">${order.items}</div>
                        `}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                    <h3 class="font-bold text-lg text-gray-800 mb-4">Delivery Information</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span class="text-gray-700">${order.location}</span>
                        </div>
                        ${order.estimatedDelivery ? `
                            <div class="flex items-center gap-2">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="text-gray-700">Estimated Delivery: ${order.estimatedDelivery}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="font-bold text-lg text-gray-800 mb-4">Tracking Timeline</h3>
                    <div class="relative">
                        ${statuses.map((status, index) => {
                            const isCompleted = index <= currentStatusIndex;
                            const isCurrent = index === currentStatusIndex;
                            const historyItem = trackingHistory.find(h => h.status === status);
                            
                            return `
                                <div class="flex items-start mb-6 ${index < statuses.length - 1 ? 'pb-6' : ''}">
                                    <div class="flex-shrink-0 mr-4">
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center ${isCompleted ? 'bg-green-500' : 'bg-gray-200'}">
                                            ${isCompleted ? `
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                            ` : `
                                                <div class="w-4 h-4 rounded-full ${isCurrent ? 'bg-green-500' : 'bg-gray-400'}"></div>
                                            `}
                                        </div>
                                        ${index < statuses.length - 1 ? `
                                            <div class="w-0.5 h-full ${isCompleted ? 'bg-green-500' : 'bg-gray-200'} ml-5 -mt-2" style="height: 60px;"></div>
                                        ` : ''}
                                    </div>
                                    <div class="flex-1 pt-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h4 class="font-semibold text-gray-800 capitalize">${status.replace('-', ' ')}</h4>
                                            ${isCurrent ? '<span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium">Current</span>' : ''}
                                        </div>
                                        ${historyItem ? `
                                            <p class="text-sm text-gray-600 mb-1">${historyItem.message}</p>
                                            <p class="text-xs text-gray-400">${historyItem.time || order.time}</p>
                                        ` : `
                                            <p class="text-sm text-gray-400">${getStatusMessage(status)}</p>
                                        `}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function getStatusMessage(status) {
            const messages = {
                'pending': 'Your order has been received and is being processed',
                'preparing': 'The chef is preparing your order',
                'on-the-way': 'Your order is on the way to you',
                'delivered': 'Your order has been delivered',
                'done': 'Order completed',
                'cancelled': 'Order has been cancelled'
            };
            return messages[status] || 'Order status updated';
        }

        function getStatusColor(status) {
            switch(status) {
                case 'pending': return 'bg-blue-100 text-blue-700';
                case 'preparing': return 'bg-yellow-100 text-yellow-700';
                case 'done': return 'bg-green-100 text-green-700';
                case 'canceled': return 'bg-red-100 text-red-700';
                default: return 'bg-gray-100 text-gray-700';
            }
        }

        function changeOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                
                // Update in myOrders array (customer's order list)
                const myOrder = myOrders.find(o => o.id === orderId);
                if (myOrder) {
                    myOrder.status = newStatus;
                    
                    // Add tracking history entry
                    if (!myOrder.trackingHistory) {
                        myOrder.trackingHistory = [];
                    }
                    
                    // Check if this status already has a history entry
                    const existingEntry = myOrder.trackingHistory.find(h => h.status === newStatus);
                    if (!existingEntry) {
                        myOrder.trackingHistory.push({
                            status: newStatus,
                            message: getStatusMessage(newStatus),
                            timestamp: new Date().toISOString(),
                            time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
                        });
                    } else {
                        // Update existing entry with new timestamp
                        existingEntry.timestamp = new Date().toISOString();
                        existingEntry.time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        existingEntry.message = getStatusMessage(newStatus);
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('myOrders', JSON.stringify(myOrders));
                    
                    // If track order page is open for this order, re-render it
                    if (currentTrackingOrderId === orderId) {
                        renderTrackOrder(myOrder);
                    }
                    
                    // If my-orders screen is open, refresh it
                    if (currentScreen === 'my-orders') {
                        renderMyOrders();
                    }
                }
                
                renderOrders();
                updateChefStats();
            }
        }

        function updateChefStats() {
            // Update chef dashboard name
            const loggedInUsername = localStorage.getItem('username');
            if (loggedInUsername) {
                const loggedInChef = chefs.find(c => c.id === loggedInUsername);
                if (loggedInChef) {
                    const nameEl = document.getElementById('chef-dashboard-name');
                    if (nameEl) {
                        nameEl.textContent = loggedInChef.kitchen;
                    }
                }
            }
            
            const pendingCount = orders.filter(o => o.status === 'pending').length;
            const today = new Date().toLocaleDateString();
            
            // Calculate today's earnings (done and preparing orders from today)
            const todayOrders = orders.filter(o => {
                if (!o.date) return false;
                return o.date === today && (o.status === 'done' || o.status === 'preparing');
            });
            const todayEarnings = todayOrders.reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            // Calculate week's orders (last 7 days, done and preparing)
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekOrders = orders.filter(o => {
                if (!o.date) return false;
                try {
                    const orderDate = new Date(o.date);
                    return orderDate >= weekAgo && (o.status === 'done' || o.status === 'preparing');
                } catch {
                    return false;
                }
            });
            
            // Calculate month's earnings
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const monthOrders = orders.filter(o => {
                if (!o.date) return false;
                try {
                    const orderDate = new Date(o.date);
                    return orderDate >= monthAgo && (o.status === 'done' || o.status === 'preparing');
                } catch {
                    return false;
                }
            });
            const monthEarnings = monthOrders.reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            const weekEarnings = weekOrders.reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            const pendingEl = document.getElementById('stats-pending');
            const todayEl = document.getElementById('stats-today');
            const weekEl = document.getElementById('stats-week');
            const monthEl = document.getElementById('stats-month');
            
            if (pendingEl) pendingEl.textContent = pendingCount;
            if (todayEl) todayEl.textContent = `JOD ${todayEarnings.toFixed(0)}`;
            if (weekEl) weekEl.textContent = `JOD ${weekEarnings.toFixed(0)}`;
            if (monthEl) monthEl.textContent = `JOD ${monthEarnings.toFixed(0)}`;
        }

        function renderOrders() {
            const cont = document.getElementById('orders-container');
            if (!cont) return;
            
            // Get current logged in chef ID
            const loggedInUsername = localStorage.getItem('username');
            if (!loggedInUsername) return;
            
            const loggedInChef = chefs.find(c => c.id === loggedInUsername);
            if (!loggedInChef) return;
            
            // Filter orders for this chef's dishes
            const chefOrders = orders.filter(o => {
                if (!o.items) return false;
                return o.items.some(item => {
                    const dish = dishes.all.find(d => d.name === item.name);
                    return dish && dish.chefId === loggedInChef.id;
                });
            });
            
            if (chefOrders.length === 0) {
                cont.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p class="text-gray-500 text-lg mb-2">No orders yet</p>
                        <p class="text-gray-400 text-sm">Customer orders will appear here</p>
                    </div>
                `;
                return;
            }
            
            cont.innerHTML = chefOrders.map(o => {
                const statusColor = getStatusColor(o.status);
                
                // Build customizations display
                let customizationsHtml = '';
                if (o.items && o.items.length > 0) {
                    const customizationsList = o.items.map(item => {
                        if (!item.customizations) return '';
                        
                        const cust = item.customizations;
                        let custText = '';
                        
                        if (cust.extraIngredients && cust.extraIngredients.length > 0) {
                            custText += `<div class="text-xs mt-1"><span class="font-medium text-green-600">+ Add:</span> ${cust.extraIngredients.join(', ')}</div>`;
                        }
                        if (cust.removeIngredients && cust.removeIngredients.length > 0) {
                            custText += `<div class="text-xs mt-1"><span class="font-medium text-red-600">- Remove:</span> ${cust.removeIngredients.join(', ')}</div>`;
                        }
                        if (cust.allergies) {
                            custText += `<div class="text-xs mt-1"><span class="font-medium text-orange-600"> Allergies:</span> ${cust.allergies}</div>`;
                        }
                        if (cust.specialInstructions) {
                            custText += `<div class="text-xs mt-1"><span class="font-medium text-blue-600"> Notes:</span> ${cust.specialInstructions}</div>`;
                        }
                        
                        return custText ? `<div class="mt-2 p-2 bg-gray-50 rounded border-l-2 border-red-500">${item.name} x${item.quantity}${custText}</div>` : '';
                    }).filter(c => c).join('');
                    
                    if (customizationsList) {
                        customizationsHtml = `<div class="mt-3 pt-3 border-t"><p class="text-xs font-semibold text-gray-700 mb-2">Customizations:</p>${customizationsList}</div>`;
                    }
                }
                
                return `
                    <div class="bg-white rounded-lg shadow p-4 mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg">#${o.id}</h3>
                                <p class="text-sm text-gray-500 mt-1">${o.customer}</p>
                                <p class="text-sm text-gray-700 mt-2 font-medium">${o.dish}</p>
                            </div>
                            <span class="px-3 py-1 ${statusColor} rounded-full text-xs font-semibold whitespace-nowrap">${o.status}</span>
                        </div>
                        ${customizationsHtml}
                        <div class="flex justify-between items-center mb-3 pb-3 border-b mt-3">
                            <div class="text-sm text-gray-500">
                                <div>${o.time}</div>
                                <div class="mt-1">${o.date}</div>
                            </div>
                            <span class="font-bold text-lg text-red-600">${o.total}</span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="changeOrderStatus('${o.id}', 'pending')" class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg border-2 ${o.status === 'pending' ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-blue-600 border-blue-300 hover:bg-blue-50'} transition">
                                Pending
                            </button>
                            <button onclick="changeOrderStatus('${o.id}', 'preparing')" class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg border-2 ${o.status === 'preparing' ? 'bg-yellow-500 text-white border-yellow-500' : 'bg-white text-yellow-600 border-yellow-300 hover:bg-yellow-50'} transition">
                                Preparing
                            </button>
                            <button onclick="changeOrderStatus('${o.id}', 'done')" class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg border-2 ${o.status === 'done' ? 'bg-green-500 text-white border-green-500' : 'bg-white text-green-600 border-green-300 hover:bg-green-50'} transition">
                                Done
                            </button>
                            <button onclick="changeOrderStatus('${o.id}', 'canceled')" class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg border-2 ${o.status === 'canceled' ? 'bg-red-500 text-white border-red-500' : 'bg-white text-red-600 border-red-300 hover:bg-red-50'} transition">
                                Canceled
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterContent(cat) {
            if (cat === 'chefs') {
                showChefs();
                return;
            }
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = 'filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium whitespace-nowrap';
            });
            event.target.className = 'filter-btn px-4 py-2 bg-red-600 text-white rounded-full text-sm font-medium whitespace-nowrap';
            renderDishes(dishes[cat] || dishes.all);
        }

        function showScreen(id) {
            if (id !== 'login-screen') previousScreen = currentScreen;
            currentScreen = id;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const targetScreen = document.getElementById(id);
            if (targetScreen) {
                targetScreen.classList.add('active');
                window.scrollTo(0, 0);
                updateTabVisibility();
                
                // Update active tab based on current screen
                const userType = localStorage.getItem('userType');
                if (userType === 'customer') {
                    document.querySelectorAll('#bottom-tabs button').forEach(btn => {
                        btn.classList.remove('active-tab');
                    });
                    
                    const tabMap = {
                        'home-screen': 'tab-home',
                        'favorites-screen': 'tab-favorites',
                        'my-bookings': 'tab-bookings',
                        'my-orders': 'tab-orders',
                        'profile-screen': 'tab-profile'
                    };
                    
                    const activeTabId = tabMap[id];
                    if (activeTabId) {
                        const activeTab = document.getElementById(activeTabId);
                        if (activeTab) {
                            activeTab.classList.add('active-tab');
                        }
                    }
                }
                
                if (id === 'cart') {
                    updateCart();
                } else if (id === 'edit-order') {
                    updateEditOrder();
                    document.getElementById('payment-cash').checked = selectedPaymentMethod === 'cash';
                    document.getElementById('payment-visa').checked = selectedPaymentMethod === 'visa';
                    
                    // Update payment option styling
                    document.querySelectorAll('.payment-option').forEach(label => {
                        label.classList.remove('border-red-500');
                        label.classList.add('border-gray-200');
                    });
                    const selectedOption = selectedPaymentMethod === 'cash' 
                        ? document.querySelector('#payment-cash').closest('label')
                        : document.querySelector('#payment-visa').closest('label');
                    if (selectedOption) {
                        selectedOption.classList.remove('border-gray-200');
                        selectedOption.classList.add('border-red-500');
                    }
                } else if (id === 'my-orders') {
                    renderMyOrders();
                } else if (id === 'masterclasses-screen') {
                    renderMasterclasses();
                } else if (id === 'my-bookings') {
                    renderMyBookings();
                } else if (id === 'favorites-screen') {
                    renderFavorites();
                } else if (id === 'profile-screen') {
                    renderProfile();
                } else if (id === 'chef-dashboard') {
                    renderOrders();
                    updateChefStats();
                    showChefTab(currentChefTab || 'orders');
                } else if (id === 'admin-dashboard') {
                    renderAdminDashboard();
                } else if (id === 'book-chef') {
                    // Add event listeners for dynamic price calculation
                    const durationSelect = document.getElementById('chef-booking-duration');
                    const guestsInput = document.getElementById('chef-booking-guests');
                    const serviceSelect = document.getElementById('chef-service-type');
                    
                    if (durationSelect) durationSelect.addEventListener('change', calculateChefBookingTotal);
                    if (guestsInput) guestsInput.addEventListener('input', calculateChefBookingTotal);
                    if (serviceSelect) serviceSelect.addEventListener('change', calculateChefBookingTotal);
                }
            }
        }

        function goBack() {
            // Always go to homepage for customers, chef dashboard for chefs
            const userType = localStorage.getItem('userType');
            if (userType === 'customer') {
                showScreen('home-screen');
            } else {
                showScreen('chef-dashboard');
            }
        }

        // Bottom Tab Navigation
        function navigateToTab(tab) {
            const userType = localStorage.getItem('userType');
            
            // Update active tab styling
            document.querySelectorAll('#bottom-tabs button').forEach(btn => {
                btn.classList.remove('active-tab');
            });
            
            if (userType === 'customer') {
                const tabMap = {
                    'home': { screen: 'home-screen', tabId: 'tab-home' },
                    'favorites': { screen: 'favorites-screen', tabId: 'tab-favorites' },
                    'bookings': { screen: 'my-bookings', tabId: 'tab-bookings' },
                    'orders': { screen: 'my-orders', tabId: 'tab-orders' },
                    'profile': { screen: 'profile-screen', tabId: 'tab-profile' }
                };
                
                if (tabMap[tab]) {
                    const activeTabBtn = document.getElementById(tabMap[tab].tabId);
                    if (activeTabBtn) {
                        activeTabBtn.classList.add('active-tab');
                    }
                    showScreen(tabMap[tab].screen);
                }
            } else if (userType === 'chef') {
                // For chefs, home tab goes to chef dashboard
                if (tab === 'home') {
                    showScreen('chef-dashboard');
                } else {
                    // Other tabs can still work for chefs if needed
                    const tabMap = {
                        'home': { screen: 'chef-dashboard', tabId: 'tab-home' },
                        'orders': { screen: 'chef-dashboard', tabId: 'tab-orders' },
                        'profile': { screen: 'profile-screen', tabId: 'tab-profile' }
                    };
                    
                    if (tabMap[tab]) {
                        const activeTabBtn = document.getElementById(tabMap[tab].tabId);
                        if (activeTabBtn) {
                            activeTabBtn.classList.add('active-tab');
                        }
                        if (tab === 'orders') {
                            showScreen('chef-dashboard');
                            showChefTab('orders');
                        } else {
                            showScreen(tabMap[tab].screen);
                        }
                    }
                }
            }
        }

        function updateTabVisibility() {
            const allTabs = document.querySelectorAll('#bottom-tabs');
            const userType = localStorage.getItem('userType');
            
            // Show tabs on all screens except login screen and admin dashboard
            allTabs.forEach(tab => {
                if (currentScreen === 'login-screen' || currentScreen === 'admin-dashboard' || userType === 'admin') {
                    tab.style.display = 'none';
                } else {
                    tab.style.display = 'block';
                }
            });
        }

        function toggleDemoAccounts() {
            const demoAccounts = document.getElementById('demo-accounts');
            if (demoAccounts) {
                demoAccounts.classList.toggle('hidden');
            }
        }

        function handleLogin() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            const err = document.getElementById('login-error');
            
            if (user === 'noor' && pass === 'customer12345678') {
                err.classList.add('hidden');
                saveLoginState('customer', user);
                showScreen('home-screen');
            } else if (user === 'layla' && pass === 'chef12345678') {
                err.classList.add('hidden');
                saveLoginState('chef', user);
                currentChefTab = 'orders';
                showScreen('chef-dashboard');
                renderOrders();
                updateChefStats();
            } else if (user === 'ahmad' && pass === 'chef12345678') {
                err.classList.add('hidden');
                saveLoginState('chef', user);
                currentChefTab = 'orders';
                showScreen('chef-dashboard');
                renderOrders();
                updateChefStats();
            } else if (user === 'admin' && pass === 'admin12345678') {
                err.classList.add('hidden');
                saveLoginState('admin', user);
                showScreen('admin-dashboard');
                renderAdminDashboard();
            } else {
                err.classList.remove('hidden');
            }
        }

        // Search Functionality
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    applySearch();
                });
            }
        }

        // Search Functionality
        function applySearch() {
            let dishesToShow = dishes.all;
            
            // Apply search filter if active
            const searchQuery = document.getElementById('search-input')?.value.toLowerCase().trim();
            if (searchQuery) {
                dishesToShow = dishesToShow.filter(dish => 
                    dish.name.toLowerCase().includes(searchQuery) ||
                    dish.chef.toLowerCase().includes(searchQuery) ||
                    dish.category.toLowerCase().includes(searchQuery) ||
                    (dish.description && dish.description.toLowerCase().includes(searchQuery))
                );
            }
            
            renderDishes(dishesToShow);
        }

        // Favorites Functionality
        function toggleFavorite(dishId) {
            const index = favorites.indexOf(dishId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(dishId);
            }
            updateFavoritesCount();
            saveFavorites();
            renderDishes(dishes.all);
        }

        function isFavorite(dishId) {
            return favorites.includes(dishId);
        }

        function updateFavoritesCount() {
            const countEl = document.getElementById('favorites-count');
            const tabCountEl = document.getElementById('tab-favorites-count');
            
            if (countEl) {
                if (favorites.length > 0) {
                    countEl.textContent = favorites.length;
                    countEl.classList.remove('hidden');
                } else {
                    countEl.classList.add('hidden');
                }
            }
            
            if (tabCountEl) {
                if (favorites.length > 0) {
                    tabCountEl.textContent = favorites.length;
                    tabCountEl.classList.remove('hidden');
                } else {
                    tabCountEl.classList.add('hidden');
                }
            }
        }

        function renderFavorites() {
            const list = document.getElementById('favorites-list');
            if (!list) return;
            
            if (favorites.length === 0) {
                list.innerHTML = `
                    <div class="col-span-2 text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <p class="text-gray-500 text-lg mb-2">No favorites yet</p>
                        <p class="text-gray-400 text-sm">Add dishes to your favorites</p>
                    </div>
                `;
                return;
            }
            
            const favoriteDishes = dishes.all.filter(d => favorites.includes(d.id));
            list.innerHTML = favoriteDishes.map(dish => `
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="relative">
                        <img src="${dish.image}" class="w-full h-40 object-cover">
                        <button onclick="toggleFavorite(${dish.id})" class="absolute top-2 right-2 p-2 bg-white rounded-full shadow-lg">
                            <svg class="w-5 h-5 text-red-600 fill-current" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="p-3">
                        <h3 class="font-bold text-sm mb-1">${dish.name}</h3>
                        <p class="text-xs text-gray-500 mb-2">${dish.chef}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-red-600 font-bold">${dish.price}</span>
                            <button onclick="viewDish(${dish.id})" class="px-3 py-1 bg-red-600 text-white text-xs rounded-lg">View</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function loadFavorites() {
            const saved = localStorage.getItem('favorites');
            if (saved) {
                try {
                    favorites = JSON.parse(saved);
                } catch (e) {
                    favorites = [];
                }
            }
            updateFavoritesCount();
        }

        // Profile Functionality
        function renderProfile() {
            const username = localStorage.getItem('username');
            if (username) {
                const nameEl = document.getElementById('profile-name');
                const initialEl = document.getElementById('profile-initial');
                if (nameEl) nameEl.textContent = username.charAt(0).toUpperCase() + username.slice(1);
                if (initialEl) initialEl.textContent = username.charAt(0).toUpperCase();
            }
            
            const totalOrders = myOrders.length;
            const totalSpent = myOrders.reduce((sum, order) => {
                const total = parseFloat(order.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            const totalOrdersEl = document.getElementById('profile-total-orders');
            const totalSpentEl = document.getElementById('profile-total-spent');
            const favoritesCountEl = document.getElementById('profile-favorites-count');
            const bookingsCountEl = document.getElementById('profile-bookings-count');
            const savedCardsEl = document.getElementById('profile-saved-cards');
            
            if (totalOrdersEl) totalOrdersEl.textContent = totalOrders;
            if (totalSpentEl) totalSpentEl.textContent = `JOD ${totalSpent.toFixed(2)}`;
            if (favoritesCountEl) favoritesCountEl.textContent = favorites.length;
            if (bookingsCountEl) bookingsCountEl.textContent = myBookings.length;
            
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                try {
                    userProfile = JSON.parse(savedProfile);
                    const addressEl = document.getElementById('profile-address');
                    if (addressEl && userProfile.address) {
                        addressEl.value = userProfile.address;
                    }
                } catch (e) {}
            }
            
            // Render saved cards
            if (savedCardsEl) {
                loadSavedCards();
                if (savedCards.length > 0) {
                    savedCardsEl.innerHTML = savedCards.map((card) => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg mb-2">
                            <div class="flex items-center gap-3">
                                <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M24 8v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2z"/>
                                </svg>
                                <div>
                                    <div class="font-semibold text-sm text-gray-800">${card.cardName}</div>
                                    <div class="text-xs text-gray-500">${card.maskedCardNumber || '**** **** **** ' + card.cardNumber.slice(-4)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    savedCardsEl.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">No saved cards</p>';
                }
            }
        }

        function saveProfile() {
            const address = document.getElementById('profile-address').value.trim();
            userProfile.address = address;
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            showCustomAlert('Profile updated successfully!', 'Success', 'success');
        }

        // Order Cancellation
        function cancelOrder(orderId) {
            showCustomConfirm(
                'Are you sure you want to cancel this order?',
                'Cancel Order',
                () => {
                    const order = myOrders.find(o => o.id === orderId);
                    if (order && order.status !== 'done' && order.status !== 'canceled') {
                        order.status = 'canceled';
                        
                        // Update in orders array too
                        const chefOrder = orders.find(o => o.id === orderId);
                        if (chefOrder) {
                            chefOrder.status = 'canceled';
                        }
                        
                        saveBookingsToStorage();
                        renderMyOrders();
                        showCustomAlert('Order canceled successfully', 'Order Canceled', 'success');
                    } else {
                        showCustomAlert('This order cannot be canceled', 'Error', 'error');
                    }
                }
            );
        }

        // Reorder Functionality
        function reorder(orderId) {
            const order = myOrders.find(o => o.id === orderId);
            if (!order) return;
            
            // Parse order items from the order.items string or use customizations
            if (order.customizations && Array.isArray(order.customizations)) {
                order.customizations.forEach(item => {
                    const dish = dishes.all.find(d => d.name === item.name);
                    if (dish) {
                        const existingItem = cart.find(c => {
                            if (c.id !== dish.id) return false;
                            if (!c.customizations && !item.customizations) return true;
                            if (!c.customizations || !item.customizations) return false;
                            return JSON.stringify(c.customizations) === JSON.stringify(item.customizations);
                        });
                        if (existingItem) {
                            existingItem.quantity += item.quantity;
                        } else {
                            cart.push({
                                ...dish,
                                quantity: item.quantity,
                                customizations: item.customizations || {}
                            });
                        }
                    }
                });
            } else {
                // Fallback: try to parse from order.items string
                const items = order.items.split(', ');
                items.forEach(itemStr => {
                    const match = itemStr.match(/(.+?)\s+x(\d+)/);
                    if (match) {
                        const dishName = match[1];
                        const quantity = parseInt(match[2]);
                        const dish = dishes.all.find(d => d.name === dishName);
                        if (dish) {
                            const existingItem = cart.find(c => c.id === dish.id && !c.customizations);
                            if (existingItem) {
                                existingItem.quantity += quantity;
                            } else {
                                cart.push({
                                    ...dish,
                                    quantity: quantity,
                                    customizations: {}
                                });
                            }
                        }
                    }
                });
            }
            
            updateCart();
            showScreen('cart');
            showCustomAlert('Items added to cart!', 'Reorder', 'success');
        }

        // Chef Menu Management
        function renderChefMenu() {
            const container = document.getElementById('chef-menu-list');
            if (!container) return;
            
            const loggedInUsername = localStorage.getItem('username');
            if (!loggedInUsername) return;
            
            const chefDishes = dishes.all.filter(d => d.chefId === loggedInUsername);
            
            if (chefDishes.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No dishes yet. Add your first dish!</p>';
                return;
            }
            
            container.innerHTML = chefDishes.map(dish => `
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg">${dish.name}</h3>
                            <p class="text-sm text-gray-500 mt-1">${dish.category}</p>
                            <div class="flex items-center mt-2">
                                <span class="text-red-600 font-bold">${dish.price}</span>
                                <span class="text-yellow-500 ml-2"> ${dish.rating}</span>
                            </div>
                        </div>
                        <img src="${dish.image}" class="w-20 h-20 rounded-lg object-cover ml-4">
                    </div>
                    <div class="flex gap-2 mt-3">
                        <button onclick="editDish(${dish.id})" class="flex-1 px-3 py-2 bg-blue-500 text-white text-sm rounded-lg font-semibold">Edit</button>
                        <button onclick="deleteDish(${dish.id})" class="flex-1 px-3 py-2 bg-red-500 text-white text-sm rounded-lg font-semibold">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddDishModal() {
            document.getElementById('add-dish-modal').classList.remove('hidden');
            document.getElementById('add-dish-modal').style.display = 'flex';
        }

        function closeAddDishModal() {
            document.getElementById('add-dish-modal').classList.add('hidden');
            document.getElementById('add-dish-modal').style.display = 'none';
            document.getElementById('admin-chef-selector').classList.add('hidden');
            document.getElementById('dish-ingredients-section').classList.add('hidden');
            document.getElementById('new-dish-name').value = '';
            document.getElementById('new-dish-price').value = '';
            document.getElementById('new-dish-category').value = 'middle-eastern';
            document.getElementById('new-dish-image').value = '';
            document.getElementById('new-dish-rating').value = '4.5';
            const chefSelect = document.getElementById('new-dish-chef');
            if (chefSelect) chefSelect.value = '';
            currentEditingDishId = null;
        }

        function saveNewDish() {
            const loggedInUsername = localStorage.getItem('username');
            if (!loggedInUsername) return;
            
            const chef = chefs.find(c => c.id === loggedInUsername);
            if (!chef) return;
            
            const name = document.getElementById('new-dish-name').value.trim();
            const price = parseFloat(document.getElementById('new-dish-price').value);
            const category = document.getElementById('new-dish-category').value;
            const image = document.getElementById('new-dish-image').value.trim() || 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400';
            const rating = document.getElementById('new-dish-rating').value;
            
            if (!name || !price) {
                showCustomAlert('Please fill in all required fields', 'Error', 'error');
                return;
            }
            
            const newId = Math.max(...dishes.all.map(d => d.id)) + 1;
            const newDish = {
                id: newId,
                name: name,
                chef: chef.kitchen,
                chefId: loggedInUsername,
                price: `JOD ${price.toFixed(2)}`,
                rating: rating,
                image: image,
                category: category
            };
            
            dishes.all.push(newDish);
            if (dishes[category]) {
                dishes[category].push(newDish);
            }
            
            closeAddDishModal();
            renderChefMenu();
            showCustomAlert('Dish added successfully!', 'Success', 'success');
        }

        function editDish(dishId) {
            const dish = dishes.all.find(d => d.id === dishId);
            if (!dish) return;
            
            document.getElementById('new-dish-name').value = dish.name;
            document.getElementById('new-dish-price').value = dish.price.replace('JOD ', '');
            document.getElementById('new-dish-category').value = dish.category;
            document.getElementById('new-dish-image').value = dish.image;
            document.getElementById('new-dish-rating').value = dish.rating;
            
            // Change button text
            const submitBtn = document.querySelector('#add-dish-modal button[type="submit"]');
            submitBtn.textContent = 'Update Dish';
            submitBtn.onclick = function(e) {
                e.preventDefault();
                updateDish(dishId);
            };
            
            showAddDishModal();
        }

        function updateDish(dishId) {
            const dish = dishes.all.find(d => d.id === dishId);
            if (!dish) return;
            
            dish.name = document.getElementById('new-dish-name').value.trim();
            dish.price = `JOD ${parseFloat(document.getElementById('new-dish-price').value).toFixed(2)}`;
            dish.category = document.getElementById('new-dish-category').value;
            dish.image = document.getElementById('new-dish-image').value.trim() || dish.image;
            dish.rating = document.getElementById('new-dish-rating').value;
            
            // Update in category array
            const categoryArray = dishes[dish.category];
            if (categoryArray) {
                const catIndex = categoryArray.findIndex(d => d.id === dishId);
                if (catIndex > -1) {
                    categoryArray[catIndex] = dish;
                }
            }
            
            closeAddDishModal();
            renderChefMenu();
            showCustomAlert('Dish updated successfully!', 'Success', 'success');
        }

        function deleteDish(dishId) {
            showCustomConfirm(
                'Are you sure you want to delete this dish?',
                'Delete Dish',
                () => {
                    dishes.all = dishes.all.filter(d => d.id !== dishId);
                    Object.keys(dishes).forEach(key => {
                        if (Array.isArray(dishes[key])) {
                            dishes[key] = dishes[key].filter(d => d.id !== dishId);
                        }
                    });
                    renderChefMenu();
                    showCustomAlert('Dish deleted successfully!', 'Success', 'success');
                }
            );
        }

        // Analytics Functionality
        function renderAnalytics() {
            const loggedInUsername = localStorage.getItem('username');
            if (!loggedInUsername) return;
            
            const chefOrders = orders.filter(o => {
                if (!o.items) return false;
                return o.items.some(item => {
                    const dish = dishes.all.find(d => d.name === item.name);
                    return dish && dish.chefId === loggedInUsername;
                });
            });
            
            // Calculate today's earnings
            const today = new Date().toLocaleDateString();
            const todayOrders = chefOrders.filter(o => o.date === today && o.status === 'done');
            const todayEarnings = todayOrders.reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            // Calculate week's earnings
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekOrders = chefOrders.filter(o => {
                const orderDate = new Date(o.date);
                return orderDate >= weekAgo && o.status === 'done';
            });
            const weekEarnings = weekOrders.reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            // Calculate month's earnings
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const monthOrders = chefOrders.filter(o => {
                const orderDate = new Date(o.date);
                return orderDate >= monthAgo && o.status === 'done';
            });
            const monthEarnings = monthOrders.reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            // Total earnings
            const totalEarnings = chefOrders.filter(o => o.status === 'done').reduce((sum, o) => {
                const total = parseFloat(o.total.replace('JOD ', ''));
                return sum + (isNaN(total) ? 0 : total);
            }, 0);
            
            // Statistics
            const completedOrders = chefOrders.filter(o => o.status === 'done').length;
            const avgOrderValue = completedOrders > 0 ? totalEarnings / completedOrders : 0;
            
            // Most popular dish
            const dishCounts = {};
            chefOrders.forEach(order => {
                if (order.items) {
                    order.items.forEach(item => {
                        const dish = dishes.all.find(d => d.name === item.name);
                        if (dish && dish.chefId === loggedInUsername) {
                            dishCounts[item.name] = (dishCounts[item.name] || 0) + item.quantity;
                        }
                    });
                }
            });
            const popularDish = Object.keys(dishCounts).length > 0 
                ? Object.keys(dishCounts).reduce((a, b) => dishCounts[a] > dishCounts[b] ? a : b)
                : '-';
            
            const pendingOrders = chefOrders.filter(o => o.status === 'pending' || o.status === 'preparing').length;
            const popularCount = popularDish !== '-' ? dishCounts[popularDish] : 0;
            
            const todayEl = document.getElementById('analytics-today');
            const weekEl = document.getElementById('analytics-week');
            const monthEl = document.getElementById('analytics-month');
            const totalEl = document.getElementById('analytics-total');
            const totalOrdersEl = document.getElementById('analytics-total-orders');
            const completedEl = document.getElementById('analytics-completed');
            const pendingEl = document.getElementById('analytics-pending');
            const avgOrderEl = document.getElementById('analytics-avg-order');
            const popularDishEl = document.getElementById('analytics-popular-dish');
            const popularCountEl = document.getElementById('analytics-popular-count');
            
            if (todayEl) todayEl.textContent = `JOD ${todayEarnings.toFixed(2)}`;
            if (weekEl) weekEl.textContent = `JOD ${weekEarnings.toFixed(2)}`;
            if (monthEl) monthEl.textContent = `JOD ${monthEarnings.toFixed(2)}`;
            if (totalEl) totalEl.textContent = `JOD ${totalEarnings.toFixed(2)}`;
            if (totalOrdersEl) totalOrdersEl.textContent = chefOrders.length;
            if (completedEl) completedEl.textContent = completedOrders;
            if (pendingEl) pendingEl.textContent = pendingOrders;
            if (avgOrderEl) avgOrderEl.textContent = `JOD ${avgOrderValue.toFixed(2)}`;
            if (popularDishEl) popularDishEl.textContent = popularDish;
            if (popularCountEl) {
                popularCountEl.textContent = popularCount > 0 ? `${popularCount} orders` : 'No orders yet';
            }
        }

        function logout() {
            clearLoginState();
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showScreen('login-screen');
        }

        // WebRTC Call Functions
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let isMuted = false;
        let isVideoEnabled = true;
        let callType = 'video';
        let currentCallParticipant = '';

        async function startCall(participantName, participantImage, type) {
            callType = type;
            currentCallParticipant = participantName;
            
            document.getElementById('call-participant-name').textContent = participantName;
            document.getElementById('call-participant-name-audio').textContent = participantName;
            document.getElementById('call-status').textContent = 'Connecting...';
            
            // Get initial from name
            const initial = participantName.charAt(0).toUpperCase();
            document.getElementById('call-participant-initial').textContent = initial;
            
            try {
                // Get user media
                const constraints = {
                    audio: true,
                    video: type === 'video' ? true : false
                };
                
                localStream = await navigator.mediaDevices.getUserMedia(constraints);
                
                const localVideo = document.getElementById('local-video');
                const remoteVideo = document.getElementById('remote-video');
                const audioOnlyDiv = document.getElementById('call-audio-only');
                
                if (type === 'video') {
                    localVideo.srcObject = localStream;
                    localVideo.style.display = 'block';
                    remoteVideo.style.display = 'block';
                    audioOnlyDiv.classList.add('hidden');
                } else {
                    localVideo.style.display = 'none';
                    remoteVideo.style.display = 'none';
                    audioOnlyDiv.classList.remove('hidden');
                }
                
                // Create peer connection
                const configuration = {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' }
                    ]
                };
                
                peerConnection = new RTCPeerConnection(configuration);
                
                // Add local stream tracks
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                // Handle remote stream
                peerConnection.ontrack = (event) => {
                    remoteStream = event.streams[0];
                    if (type === 'video') {
                        remoteVideo.srcObject = remoteStream;
                    }
                };
                
                // Create offer
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                
                // Simulate receiving answer (in real app, this would come from signaling server)
                setTimeout(() => {
                    // Simulate remote peer connection
                    simulateRemoteConnection(offer, type);
                }, 1000);
                
                showScreen('call-screen');
                document.getElementById('call-status').textContent = 'Connected';
                
            } catch (error) {
                console.error('Error starting call:', error);
                showCustomAlert('Failed to start call. Please check your camera/microphone permissions.', 'Call Error', 'error');
            }
        }

        async function simulateRemoteConnection(offer, type) {
            // This simulates the remote peer accepting the call
            // In a real app, this would be handled by a signaling server
            try {
                const remotePC = new RTCPeerConnection({
                    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
                });
                
                // Create a dummy stream for simulation
                const dummyStream = await navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: type === 'video'
                });
                
                dummyStream.getTracks().forEach(track => {
                    remotePC.addTrack(track, dummyStream);
                });
                
                await remotePC.setRemoteDescription(offer);
                const answer = await remotePC.createAnswer();
                await remotePC.setLocalDescription(answer);
                
                // Set the answer on our peer connection
                await peerConnection.setRemoteDescription(answer);
                
            } catch (error) {
                console.error('Error simulating remote connection:', error);
            }
        }

        function endCall() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            if (remoteStream) {
                remoteStream.getTracks().forEach(track => track.stop());
                remoteStream = null;
            }
            
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            const localVideo = document.getElementById('local-video');
            const remoteVideo = document.getElementById('remote-video');
            if (localVideo) localVideo.srcObject = null;
            if (remoteVideo) remoteVideo.srcObject = null;
            
            isMuted = false;
            isVideoEnabled = true;
            
            // Return to previous screen
            if (previousScreen) {
                showScreen(previousScreen);
            } else {
                const userType = localStorage.getItem('userType');
                if (userType === 'customer') {
                    showScreen('home-screen');
                } else {
                    showScreen('chef-dashboard');
                }
            }
        }

        function toggleMute() {
            if (localStream) {
                const audioTracks = localStream.getAudioTracks();
                audioTracks.forEach(track => {
                    track.enabled = isMuted;
                });
                isMuted = !isMuted;
                
                const micIcon = document.getElementById('mic-icon');
                if (isMuted) {
                    micIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M13 18h.01M9 18h.01"/></svg>';
                } else {
                    micIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>';
                }
            }
        }

        function toggleVideo() {
            if (localStream && callType === 'video') {
                const videoTracks = localStream.getVideoTracks();
                videoTracks.forEach(track => {
                    track.enabled = !isVideoEnabled;
                });
                isVideoEnabled = !isVideoEnabled;
                
                const localVideo = document.getElementById('local-video');
                if (localVideo) {
                    localVideo.style.opacity = isVideoEnabled ? '1' : '0.5';
                }
                
                const videoIcon = document.getElementById('video-icon');
                if (!isVideoEnabled) {
                    videoIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>';
                } else {
                    videoIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>';
                }
            }
        }

        // Pull to Refresh Functionality
        let pullToRefreshState = {
            startY: 0,
            currentY: 0,
            isPulling: false,
            threshold: 80,
            isRefreshing: false
        };

        function initPullToRefresh() {
            const refreshIndicator = document.getElementById('pull-to-refresh');
            let touchStartY = 0;
            let scrollTop = 0;

            // Touch events for mobile
            document.addEventListener('touchstart', (e) => {
                if (currentScreen === 'login-screen') return;
                touchStartY = e.touches[0].clientY;
                scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            }, { passive: true });

            document.addEventListener('touchmove', (e) => {
                if (currentScreen === 'login-screen' || pullToRefreshState.isRefreshing) return;
                
                const touchY = e.touches[0].clientY;
                const scrollY = window.pageYOffset || document.documentElement.scrollTop;
                
                // Only trigger if at the top of the page and pulling down
                if (scrollY === 0 && touchY > touchStartY) {
                    const pullDistance = touchY - touchStartY;
                    
                    if (pullDistance > 0) {
                        pullToRefreshState.isPulling = true;
                        pullToRefreshState.currentY = pullDistance;
                        
                        // Show indicator when threshold is reached
                        if (pullDistance >= pullToRefreshState.threshold) {
                            refreshIndicator.classList.add('active');
                        } else {
                            refreshIndicator.classList.remove('active');
                        }
                    }
                }
            }, { passive: true });

            document.addEventListener('touchend', () => {
                if (currentScreen === 'login-screen') return;
                
                if (pullToRefreshState.isPulling && pullToRefreshState.currentY >= pullToRefreshState.threshold) {
                    refreshIndicator.classList.add('active');
                    pullToRefreshState.isRefreshing = true;
                    refreshPage();
                } else {
                    refreshIndicator.classList.remove('active');
                }
                
                // Reset state
                pullToRefreshState.isPulling = false;
                pullToRefreshState.currentY = 0;
                touchStartY = 0;
            }, { passive: true });

            // Mouse events for desktop (scroll wheel)
            let lastScrollTop = 0;
            document.addEventListener('scroll', () => {
                if (currentScreen === 'login-screen' || pullToRefreshState.isRefreshing) return;
                
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // Detect overscroll at top (negative scroll)
                if (scrollTop < 0 && Math.abs(scrollTop) >= pullToRefreshState.threshold) {
                    if (!refreshIndicator.classList.contains('active')) {
                        refreshIndicator.classList.add('active');
                        pullToRefreshState.isRefreshing = true;
                        refreshPage();
                    }
                } else if (scrollTop >= 0) {
                    refreshIndicator.classList.remove('active');
                    pullToRefreshState.isRefreshing = false;
                }
                
                lastScrollTop = scrollTop;
            }, { passive: true });
        }

        function refreshPage() {
            const userType = localStorage.getItem('userType');
            const currentScreenId = currentScreen;
            
            // Show refresh indicator
            const refreshIndicator = document.getElementById('pull-to-refresh');
            refreshIndicator.classList.add('active');
            
            // Simulate refresh delay
            setTimeout(() => {
                // Refresh content based on current screen
                if (currentScreenId === 'home-screen') {
                    renderDishes(dishes.all);
                    applySearch();
                } else if (currentScreenId === 'favorites-screen') {
                    renderFavorites();
                } else if (currentScreenId === 'my-orders') {
                    renderMyOrders();
                } else if (currentScreenId === 'my-bookings') {
                    renderMyBookings();
                } else if (currentScreenId === 'profile-screen') {
                    renderProfile();
                } else if (currentScreenId === 'chef-dashboard') {
                    renderOrders();
                    updateChefStats();
                    if (currentChefTab === 'menu') {
                        renderChefMenu();
                    } else if (currentChefTab === 'analytics') {
                        renderAnalytics();
                    } else if (currentChefTab === 'bookings') {
                        renderChefBookings();
                    }
                } else if (currentScreenId === 'masterclasses-screen') {
                    renderMasterclasses();
                } else if (currentScreenId === 'chefs-screen') {
                    renderChefs();
                }
                
                // Hide refresh indicator
                setTimeout(() => {
                    refreshIndicator.classList.remove('active');
                    pullToRefreshState.isRefreshing = false;
                }, 500);
            }, 1000);
        }

        // Admin Dashboard Functions
        let currentAdminTab = 'dishes';

        function showAdminTab(tab) {
            currentAdminTab = tab;
            
            // Reset all tabs
            ['dishes', 'chefs'].forEach(t => {
                const tabBtn = document.getElementById(`admin-tab-${t}`);
                const container = document.getElementById(`admin-${t}-container`);
                if (tabBtn) {
                    tabBtn.classList.remove('border-red-600', 'text-red-600');
                    tabBtn.classList.add('border-transparent', 'text-gray-500');
                }
                if (container) {
                    container.classList.add('hidden');
                }
            });
            
            // Activate selected tab
            const activeTabBtn = document.getElementById(`admin-tab-${tab}`);
            const activeContainer = document.getElementById(`admin-${tab}-container`);
            
            if (activeTabBtn) {
                activeTabBtn.classList.remove('border-transparent', 'text-gray-500');
                activeTabBtn.classList.add('border-red-600', 'text-red-600');
            }
            if (activeContainer) {
                activeContainer.classList.remove('hidden');
            }
            
            // Update admin stats
            const totalDishesEl = document.getElementById('admin-total-dishes');
            const totalChefsEl = document.getElementById('admin-total-chefs');
            const totalOrdersEl = document.getElementById('admin-total-orders');
            if (totalDishesEl) totalDishesEl.textContent = dishes.all.length;
            if (totalChefsEl) totalChefsEl.textContent = chefs.length;
            if (totalOrdersEl) totalOrdersEl.textContent = orders.length;
            
            // Render content based on tab
            if (tab === 'dishes') {
                renderAdminDishes();
            } else if (tab === 'chefs') {
                renderAdminChefs();
            }
        }

        function renderAdminDashboard() {
            showAdminTab(currentAdminTab || 'dishes');
        }

        function renderAdminDishes() {
            const container = document.getElementById('admin-dishes-container');
            if (!container) return;
            
            container.innerHTML = `
                <div class="mb-6 flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">All Dishes</h2>
                        <p class="text-xs text-gray-500 mt-0.5">${dishes.all.length} dishes</p>
                    </div>
                    <button onclick="showAddDishModalAdmin()" class="btn-primary text-white px-4 py-2 rounded-lg font-medium text-sm shadow-sm hover:shadow transition-all flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add Dish
                    </button>
                </div>
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Dish</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Chef</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Category</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Price</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Rating</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Customizations</th>
                                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-100">
                                ${dishes.all.map((dish, index) => {
                                    const addCount = (dish.customIngredients?.add || []).length;
                                    const removeCount = (dish.customIngredients?.remove || []).length;
                                    return `
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
                                                    <img src="${dish.image}" class="w-full h-full object-cover" alt="${dish.name}">
                                                </div>
                                                <div class="min-w-0">
                                                    <div class="font-medium text-sm text-gray-900 truncate">${dish.name}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="text-sm text-gray-600">${dish.chef}</div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-50 text-red-700 capitalize">${dish.category.replace('-', ' ')}</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="text-sm font-semibold text-gray-900">${dish.price}</div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-1">
                                                <svg class="w-3.5 h-3.5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <span class="text-sm text-gray-700 font-medium">${dish.rating}</span>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-1.5 flex-wrap">
                                                ${addCount > 0 ? `
                                                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                                    </svg>
                                                    ${addCount}
                                                </span>
                                                ` : ''}
                                                ${removeCount > 0 ? `
                                                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-amber-50 text-amber-700 border border-amber-200">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                                    </svg>
                                                    ${removeCount}
                                                </span>
                                                ` : ''}
                                                ${addCount === 0 && removeCount === 0 ? `
                                                <span class="text-xs text-gray-400"></span>
                                                ` : ''}
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center justify-end gap-1.5">
                                                <button onclick="editDishAdmin(${dish.id})" class="p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors" title="Edit">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                                    </svg>
                                                </button>
                                                <button onclick="deleteDishAdmin(${dish.id})" class="p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors" title="Delete">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }


        function renderAdminChefs() {
            const container = document.getElementById('admin-chefs-container');
            if (!container) return;
            
            container.innerHTML = `
                <div class="mb-4">
                    <button onclick="showAddChefModal()" class="btn-primary text-white px-4 py-2 rounded-lg font-semibold text-sm">+ Add New Chef</button>
                </div>
                <div class="space-y-4">
                    ${chefs.map(chef => `
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-3 flex-1">
                                    <img src="${chef.image}" class="w-16 h-16 rounded-full object-cover">
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-lg">${chef.name}</h3>
                                        <p class="text-sm text-gray-500">${chef.kitchen}</p>
                                        <p class="text-xs text-gray-400">${chef.specialty}</p>
                                        <div class="flex items-center gap-3 mt-1 text-sm">
                                            <span class="text-yellow-500"> ${chef.rating}</span>
                                            <span class="text-gray-500">${chef.reviews}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex gap-2 ml-4">
                                    <button onclick="editChefAdmin('${chef.id}')" class="px-3 py-2 bg-blue-500 text-white text-sm rounded-lg font-semibold">Edit</button>
                                    <button onclick="deleteChefAdmin('${chef.id}')" class="px-3 py-2 bg-red-500 text-white text-sm rounded-lg font-semibold">Delete</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Admin Dish Management
        function showAddDishModalAdmin() {
            currentEditingDishId = null;
            
            // Update modal title
            document.getElementById('dish-modal-title').textContent = 'Add New Dish';
            document.getElementById('dish-modal-submit').textContent = 'Add Dish';
            
            // Reset form
            document.getElementById('new-dish-name').value = '';
            document.getElementById('new-dish-price').value = '';
            document.getElementById('new-dish-category').value = 'middle-eastern';
            document.getElementById('new-dish-image').value = '';
            document.getElementById('new-dish-rating').value = '4.5';
            
            // Show chef selector and ingredients section
            document.getElementById('admin-chef-selector').classList.remove('hidden');
            document.getElementById('dish-ingredients-section').classList.remove('hidden');
            
            // Populate chef selector
            const chefSelect = document.getElementById('new-dish-chef');
            if (chefSelect) {
                chefSelect.innerHTML = chefs.map(c => `<option value="${c.id}">${c.name} - ${c.kitchen}</option>`).join('');
            }
            
            // Clear ingredients and reset counts
            document.getElementById('dish-add-ingredients-list').innerHTML = '<p class="text-xs text-gray-400 text-center py-4 italic">No ingredients added yet</p>';
            document.getElementById('dish-remove-ingredients-list').innerHTML = '<p class="text-xs text-gray-400 text-center py-4 italic">No ingredients to remove yet</p>';
            const addCountEl = document.getElementById('ingredient-count-add');
            const removeCountEl = document.getElementById('ingredient-count-remove');
            if (addCountEl) addCountEl.textContent = '0 add';
            if (removeCountEl) removeCountEl.textContent = '0 remove';
            
            document.getElementById('add-dish-modal').classList.remove('hidden');
            document.getElementById('add-dish-modal').style.display = 'flex';
        }

        function saveNewDishAdmin() {
            const name = document.getElementById('new-dish-name').value.trim();
            const price = parseFloat(document.getElementById('new-dish-price').value);
            const category = document.getElementById('new-dish-category').value;
            const image = document.getElementById('new-dish-image').value.trim() || 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400';
            const rating = document.getElementById('new-dish-rating').value;
            const chefId = document.getElementById('new-dish-chef').value;
            
            if (!name || !price || !chefId) {
                showCustomAlert('Please fill in all required fields', 'Error', 'error');
                return;
            }
            
            const chef = chefs.find(c => c.id === chefId);
            if (!chef) {
                showCustomAlert('Invalid chef selected', 'Error', 'error');
                return;
            }
            
            const newId = Math.max(...dishes.all.map(d => d.id), 0) + 1;
            const newDish = {
                id: newId,
                name: name,
                chef: chef.kitchen,
                chefId: chefId,
                price: `JOD ${price.toFixed(2)}`,
                rating: rating,
                image: image,
                category: category,
                customIngredients: { add: [], remove: [] }
            };
            
            dishes.all.push(newDish);
            if (dishes[category]) {
                dishes[category].push(newDish);
            }
            
            closeAddDishModal();
            renderAdminDishes();
            showCustomAlert('Dish added successfully!', 'Success', 'success');
        }

        let currentEditingDishId = null;
        let currentIngredientType = 'add';

        function editDishAdmin(dishId) {
            const dish = dishes.all.find(d => d.id === dishId);
            if (!dish) return;
            
            currentEditingDishId = dishId;
            
            // Initialize customIngredients if not exists
            if (!dish.customIngredients) {
                dish.customIngredients = { add: [], remove: [] };
            }
            
            // Update modal title
            document.getElementById('dish-modal-title').textContent = 'Edit Dish';
            document.getElementById('dish-modal-submit').textContent = 'Update Dish';
            
            // Populate form fields
            document.getElementById('new-dish-name').value = dish.name;
            document.getElementById('new-dish-price').value = dish.price.replace('JOD ', '');
            document.getElementById('new-dish-category').value = dish.category;
            document.getElementById('new-dish-image').value = dish.image;
            document.getElementById('new-dish-rating').value = dish.rating;
            
            // Show chef selector and ingredients section
            document.getElementById('admin-chef-selector').classList.remove('hidden');
            document.getElementById('dish-ingredients-section').classList.remove('hidden');
            
            // Populate chef selector
            const chefSelect = document.getElementById('new-dish-chef');
            if (chefSelect) {
                chefSelect.innerHTML = chefs.map(c => `<option value="${c.id}">${c.name} - ${c.kitchen}</option>`).join('');
                chefSelect.value = dish.chefId;
            }
            
            // Render current ingredients
            renderDishIngredients(dish);
            
            document.getElementById('add-dish-modal').classList.remove('hidden');
            document.getElementById('add-dish-modal').style.display = 'flex';
        }

        function renderDishIngredients(dish) {
            const addList = document.getElementById('dish-add-ingredients-list');
            const removeList = document.getElementById('dish-remove-ingredients-list');
            
            // Ensure customIngredients structure
            if (!dish.customIngredients) {
                dish.customIngredients = { add: [], remove: [] };
            }
            
            // Normalize ingredients to objects with name and price
            const normalizeIngredient = (ing) => {
                if (typeof ing === 'string') {
                    return { name: ing, price: 0.50 };
                }
                return ing;
            };
            
            const addIngredients = (dish.customIngredients.add || []).map(normalizeIngredient);
            const removeIngredients = (dish.customIngredients.remove || []).map(normalizeIngredient);
            
            // Update ingredient counts
            const addCountEl = document.getElementById('ingredient-count-add');
            const removeCountEl = document.getElementById('ingredient-count-remove');
            if (addCountEl) addCountEl.textContent = `${addIngredients.length} add`;
            if (removeCountEl) removeCountEl.textContent = `${removeIngredients.length} remove`;
            
            if (addList) {
                if (addIngredients.length > 0) {
                    addList.innerHTML = addIngredients.map((ing, index) => {
                        const ingName = ing.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        return `
                        <div class="flex items-center justify-between p-3 bg-white border-2 border-gray-200 rounded-lg hover:border-green-400 hover:shadow-sm transition-all group">
                            <div class="flex-1 min-w-0">
                                <div class="font-semibold text-sm text-gray-800 truncate">${ing.name}</div>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-xs font-medium text-green-600">+${ing.price.toFixed(2)} JOD</span>
                                    <span class="text-xs text-gray-400"></span>
                                    <span class="text-xs text-gray-500">Extra charge</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-1 ml-2">
                                <button onclick="editIngredientPrice('add', ${index})" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100" title="Edit Price">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </button>
                                <button onclick="removeIngredientFromDish('add', '${ingName}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100" title="Remove">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                    }).join('');
                } else {
                    addList.innerHTML = '<p class="text-xs text-gray-400 text-center py-4 italic">No ingredients added yet</p>';
                }
            }
            
            if (removeList) {
                if (removeIngredients.length > 0) {
                    removeList.innerHTML = removeIngredients.map((ing, index) => {
                        const ingName = ing.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        return `
                        <div class="flex items-center justify-between p-3 bg-white border-2 border-gray-200 rounded-lg hover:border-orange-400 hover:shadow-sm transition-all group">
                            <div class="flex-1 min-w-0">
                                <div class="font-semibold text-sm text-gray-800 truncate">${ing.name}</div>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-xs font-medium text-orange-600">Free</span>
                                    <span class="text-xs text-gray-400"></span>
                                    <span class="text-xs text-gray-500">No charge</span>
                                </div>
                            </div>
                            <button onclick="removeIngredientFromDish('remove', '${ingName}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100 ml-2" title="Remove">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    `;
                    }).join('');
                } else {
                    removeList.innerHTML = '<p class="text-xs text-gray-400 text-center py-4 italic">No ingredients to remove yet</p>';
                }
            }
        }

        function addIngredientToDish(type) {
            currentIngredientType = type;
            const modal = document.getElementById('add-ingredient-to-dish-modal');
            const priceField = document.getElementById('ingredient-price-field');
            
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            document.getElementById('new-dish-ingredient-name').value = '';
            
            // Show price field only for "add" ingredients
            if (type === 'add') {
                priceField.classList.remove('hidden');
                document.getElementById('new-dish-ingredient-price').value = '0.50';
            } else {
                priceField.classList.add('hidden');
            }
        }

        function closeAddIngredientToDishModal() {
            document.getElementById('add-ingredient-to-dish-modal').classList.add('hidden');
            document.getElementById('add-ingredient-to-dish-modal').style.display = 'none';
        }

        function saveIngredientToDish() {
            if (!currentEditingDishId) return;
            
            const dish = dishes.all.find(d => d.id === currentEditingDishId);
            if (!dish) return;
            
            if (!dish.customIngredients) {
                dish.customIngredients = { add: [], remove: [] };
            }
            
            const ingredientName = document.getElementById('new-dish-ingredient-name').value.trim();
            if (!ingredientName) {
                showCustomAlert('Please enter an ingredient name', 'Error', 'error');
                return;
            }
            
            // Check if ingredient already exists
            const existingAdd = dish.customIngredients.add.map(ing => typeof ing === 'string' ? ing : ing.name);
            const existingRemove = dish.customIngredients.remove.map(ing => typeof ing === 'string' ? ing : ing.name);
            
            if (currentIngredientType === 'add' && existingAdd.includes(ingredientName)) {
                showCustomAlert('This ingredient already exists!', 'Error', 'error');
                return;
            }
            if (currentIngredientType === 'remove' && existingRemove.includes(ingredientName)) {
                showCustomAlert('This ingredient already exists!', 'Error', 'error');
                return;
            }
            
            // Add ingredient with price if it's an "add" ingredient
            if (currentIngredientType === 'add') {
                const price = parseFloat(document.getElementById('new-dish-ingredient-price').value) || 0.50;
                dish.customIngredients.add.push({ name: ingredientName, price: price });
            } else {
                dish.customIngredients.remove.push({ name: ingredientName, price: 0 });
            }
            
            // Update in real-time
            renderDishIngredients(dish);
            renderAdminDishes(); // Update the dish list immediately
            closeAddIngredientToDishModal();
        }

        let currentEditingIngredientIndex = null;
        let currentEditingIngredientType = null;

        function editIngredientPrice(type, index) {
            if (!currentEditingDishId) return;
            
            const dish = dishes.all.find(d => d.id === currentEditingDishId);
            if (!dish || !dish.customIngredients) return;
            
            const ingredients = dish.customIngredients[type];
            if (!ingredients[index]) return;
            
            const ing = typeof ingredients[index] === 'string' 
                ? { name: ingredients[index], price: 0.50 }
                : ingredients[index];
            
            currentEditingIngredientIndex = index;
            currentEditingIngredientType = type;
            
            document.getElementById('edit-ingredient-price-name').textContent = ing.name;
            document.getElementById('edit-ingredient-price-value').value = ing.price.toFixed(2);
            
            document.getElementById('edit-ingredient-price-modal').classList.remove('hidden');
            document.getElementById('edit-ingredient-price-modal').style.display = 'flex';
        }

        function closeEditIngredientPriceModal() {
            document.getElementById('edit-ingredient-price-modal').classList.add('hidden');
            document.getElementById('edit-ingredient-price-modal').style.display = 'none';
            currentEditingIngredientIndex = null;
            currentEditingIngredientType = null;
        }

        function saveIngredientPrice() {
            if (!currentEditingDishId || currentEditingIngredientIndex === null) return;
            
            const dish = dishes.all.find(d => d.id === currentEditingDishId);
            if (!dish || !dish.customIngredients) return;
            
            const ingredients = dish.customIngredients[currentEditingIngredientType];
            if (!ingredients[currentEditingIngredientIndex]) return;
            
            const ing = typeof ingredients[currentEditingIngredientIndex] === 'string' 
                ? { name: ingredients[currentEditingIngredientIndex], price: 0.50 }
                : ingredients[currentEditingIngredientIndex];
            
            const price = parseFloat(document.getElementById('edit-ingredient-price-value').value);
            if (isNaN(price) || price < 0) {
                showCustomAlert('Please enter a valid price', 'Error', 'error');
                return;
            }
            
            ingredients[currentEditingIngredientIndex] = { name: ing.name, price: price };
            
            // Update in real-time
            renderDishIngredients(dish);
            renderAdminDishes();
            closeEditIngredientPriceModal();
        }

        function removeIngredientFromDish(type, ingredient) {
            if (!currentEditingDishId) return;
            
            const dish = dishes.all.find(d => d.id === currentEditingDishId);
            if (!dish || !dish.customIngredients) return;
            
            showCustomConfirm(
                `Are you sure you want to remove "${ingredient}"?`,
                'Remove Ingredient',
                () => {
                    dish.customIngredients[type] = dish.customIngredients[type].filter(ing => {
                        const ingName = typeof ing === 'string' ? ing : ing.name;
                        return ingName !== ingredient;
                    });
                    
                    // Update in real-time
                    renderDishIngredients(dish);
                    renderAdminDishes();
                }
            );
        }

        function updateDishAdmin(dishId) {
            const dish = dishes.all.find(d => d.id === dishId);
            if (!dish) return;
            
            // Update dish properties in real-time
            dish.name = document.getElementById('new-dish-name').value.trim();
            dish.price = `JOD ${parseFloat(document.getElementById('new-dish-price').value).toFixed(2)}`;
            dish.category = document.getElementById('new-dish-category').value;
            dish.image = document.getElementById('new-dish-image').value.trim() || dish.image;
            dish.rating = document.getElementById('new-dish-rating').value;
            dish.chefId = document.getElementById('new-dish-chef').value;
            
            // Preserve customIngredients (already updated in real-time)
            if (!dish.customIngredients) {
                dish.customIngredients = { add: [], remove: [] };
            }
            
            const chef = chefs.find(c => c.id === dish.chefId);
            if (chef) {
                dish.chef = chef.kitchen;
            }
            
            // Update in category array
            Object.keys(dishes).forEach(key => {
                if (Array.isArray(dishes[key])) {
                    const index = dishes[key].findIndex(d => d.id === dishId);
                    if (index > -1) {
                        dishes[key].splice(index, 1);
                    }
                }
            });
            
            if (dishes[dish.category]) {
                dishes[dish.category].push(dish);
            }
            
            // Update UI in real-time
            renderAdminDishes();
            currentEditingDishId = null;
            closeAddDishModal();
            showCustomAlert('Dish updated successfully!', 'Success', 'success');
        }

        function deleteDishAdmin(dishId) {
            showCustomConfirm(
                'Are you sure you want to delete this dish? This action cannot be undone.',
                'Delete Dish',
                () => {
                    dishes.all = dishes.all.filter(d => d.id !== dishId);
                    Object.keys(dishes).forEach(key => {
                        if (Array.isArray(dishes[key])) {
                            dishes[key] = dishes[key].filter(d => d.id !== dishId);
                        }
                    });
                    renderAdminDishes();
                    showCustomAlert('Dish deleted successfully!', 'Success', 'success');
                }
            );
        }

        // Admin Ingredient Management
        let currentIngredientCategory = '';

        function showAddIngredientModal(category) {
            currentIngredientCategory = category;
            document.getElementById('add-ingredient-modal').classList.remove('hidden');
            document.getElementById('add-ingredient-modal').style.display = 'flex';
            document.getElementById('new-ingredient-category').value = category;
            document.getElementById('new-ingredient-name').value = '';
        }

        function closeAddIngredientModal() {
            document.getElementById('add-ingredient-modal').classList.add('hidden');
            document.getElementById('add-ingredient-modal').style.display = 'none';
            document.getElementById('new-ingredient-name').value = '';
        }

        function saveNewIngredient() {
            const category = document.getElementById('new-ingredient-category').value;
            const type = document.getElementById('new-ingredient-type').value;
            const name = document.getElementById('new-ingredient-name').value.trim();
            
            if (!name) {
                showCustomAlert('Please enter an ingredient name', 'Error', 'error');
                return;
            }
            
            if (!ingredientsData[category]) {
                ingredientsData[category] = { add: [], remove: [] };
            }
            
            if (ingredientsData[category][type].includes(name)) {
                showCustomAlert('This ingredient already exists!', 'Error', 'error');
                return;
            }
            
            ingredientsData[category][type].push(name);
            saveIngredientsData();
            renderAdminIngredients();
            closeAddIngredientModal();
            showCustomAlert('Ingredient added successfully!', 'Success', 'success');
        }

        function removeIngredient(category, type, ingredient) {
            showCustomConfirm(
                `Are you sure you want to remove "${ingredient}" from ${category} ${type} ingredients?`,
                'Remove Ingredient',
                () => {
                    if (ingredientsData[category] && ingredientsData[category][type]) {
                        ingredientsData[category][type] = ingredientsData[category][type].filter(ing => ing !== ingredient);
                        saveIngredientsData();
                        renderAdminIngredients();
                        showCustomAlert('Ingredient removed successfully!', 'Success', 'success');
                    }
                }
            );
        }

        function saveIngredientsData() {
            localStorage.setItem('ingredientsData', JSON.stringify(ingredientsData));
        }

        // Admin Chef Management
        function showAddChefModal() {
            currentEditingChefId = null;
            
            document.getElementById('edit-chef-modal-title').textContent = 'Add New Chef';
            document.getElementById('edit-chef-name').value = '';
            document.getElementById('edit-chef-kitchen').value = '';
            document.getElementById('edit-chef-specialty').value = '';
            document.getElementById('edit-chef-rating').value = '4.5';
            document.getElementById('edit-chef-reviews').value = '0 reviews';
            document.getElementById('edit-chef-bio').value = '';
            document.getElementById('edit-chef-image').value = 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400';
            
            document.getElementById('edit-chef-modal').classList.remove('hidden');
            document.getElementById('edit-chef-modal').style.display = 'flex';
        }

        function saveChefEdit() {
            const name = document.getElementById('edit-chef-name').value.trim();
            const kitchen = document.getElementById('edit-chef-kitchen').value.trim();
            const specialty = document.getElementById('edit-chef-specialty').value.trim();
            
            if (!name || !kitchen || !specialty) {
                showCustomAlert('Please fill in all required fields', 'Error', 'error');
                return;
            }
            
            if (currentEditingChefId) {
                // Update existing chef
                const chef = chefs.find(c => c.id === currentEditingChefId);
                if (!chef) return;
                
                chef.name = name;
                chef.kitchen = kitchen;
                chef.specialty = specialty;
                chef.rating = document.getElementById('edit-chef-rating').value || chef.rating;
                chef.reviews = document.getElementById('edit-chef-reviews').value || chef.reviews;
                chef.bio = document.getElementById('edit-chef-bio').value || chef.bio;
                chef.image = document.getElementById('edit-chef-image').value || chef.image;
                
                // Update dishes that reference this chef
                dishes.all.forEach(dish => {
                    if (dish.chefId === currentEditingChefId) {
                        dish.chef = chef.kitchen;
                    }
                });
                
                closeEditChefModal();
                renderAdminChefs();
                showCustomAlert('Chef updated successfully!', 'Success', 'success');
            } else {
                // Add new chef
                const newId = name.toLowerCase().replace(/\s+/g, '');
                const newChef = {
                    id: newId,
                    name: name,
                    kitchen: kitchen,
                    specialty: specialty,
                    rating: document.getElementById('edit-chef-rating').value || '4.5',
                    reviews: document.getElementById('edit-chef-reviews').value || '0 reviews',
                    bio: document.getElementById('edit-chef-bio').value || '',
                    image: document.getElementById('edit-chef-image').value || 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400',
                    dishes: 0,
                    orders: 0,
                    experience: 0
                };
                
                chefs.push(newChef);
                closeEditChefModal();
                renderAdminChefs();
                showCustomAlert('Chef added successfully!', 'Success', 'success');
            }
        }

        let currentEditingChefId = null;

        function editChefAdmin(chefId) {
            const chef = chefs.find(c => c.id === chefId);
            if (!chef) return;
            
            currentEditingChefId = chefId;
            
            document.getElementById('edit-chef-modal-title').textContent = 'Edit Chef';
            document.getElementById('edit-chef-name').value = chef.name;
            document.getElementById('edit-chef-kitchen').value = chef.kitchen;
            document.getElementById('edit-chef-specialty').value = chef.specialty;
            document.getElementById('edit-chef-rating').value = chef.rating;
            document.getElementById('edit-chef-reviews').value = chef.reviews || '';
            document.getElementById('edit-chef-bio').value = chef.bio || '';
            document.getElementById('edit-chef-image').value = chef.image || '';
            
            document.getElementById('edit-chef-modal').classList.remove('hidden');
            document.getElementById('edit-chef-modal').style.display = 'flex';
        }

        function closeEditChefModal() {
            document.getElementById('edit-chef-modal').classList.add('hidden');
            document.getElementById('edit-chef-modal').style.display = 'none';
            currentEditingChefId = null;
        }

        function saveChefEdit() {
            if (!currentEditingChefId) return;
            
            const chef = chefs.find(c => c.id === currentEditingChefId);
            if (!chef) return;
            
            const name = document.getElementById('edit-chef-name').value.trim();
            const kitchen = document.getElementById('edit-chef-kitchen').value.trim();
            const specialty = document.getElementById('edit-chef-specialty').value.trim();
            
            if (!name || !kitchen || !specialty) {
                showCustomAlert('Please fill in all required fields', 'Error', 'error');
                return;
            }
            
            chef.name = name;
            chef.kitchen = kitchen;
            chef.specialty = specialty;
            chef.rating = document.getElementById('edit-chef-rating').value || chef.rating;
            chef.reviews = document.getElementById('edit-chef-reviews').value || chef.reviews;
            chef.bio = document.getElementById('edit-chef-bio').value || chef.bio;
            chef.image = document.getElementById('edit-chef-image').value || chef.image;
            
            // Update dishes that reference this chef
            dishes.all.forEach(dish => {
                if (dish.chefId === currentEditingChefId) {
                    dish.chef = chef.kitchen;
                }
            });
            
            closeEditChefModal();
            renderAdminChefs();
            showCustomAlert('Chef updated successfully!', 'Success', 'success');
        }

        function deleteChefAdmin(chefId) {
            const chef = chefs.find(c => c.id === chefId);
            if (!chef) return;
            
            // Check if chef has dishes
            const chefDishes = dishes.all.filter(d => d.chefId === chefId);
            if (chefDishes.length > 0) {
                showCustomAlert(`Cannot delete chef. ${chefDishes.length} dish(es) are associated with this chef. Please reassign or delete the dishes first.`, 'Cannot Delete', 'error');
                return;
            }
            
            showCustomConfirm(
                `Are you sure you want to delete ${chef.name}? This action cannot be undone.`,
                'Delete Chef',
                () => {
                    chefs.splice(chefs.findIndex(c => c.id === chefId), 1);
                    renderAdminChefs();
                    showCustomAlert('Chef deleted successfully!', 'Success', 'success');
                }
            );
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderDishes(dishes.all);
            checkLoginState();
            setupSearch();
            updateFavoritesCount();
            updateTabVisibility();
            initPullToRefresh();
            loadSavedCards(); // Load saved cards on page load
            document.getElementById('username').addEventListener('keypress', e => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('password').addEventListener('keypress', e => {
                if (e.key === 'Enter') handleLogin();
            });
        });
    </script>
</body>
</html>
